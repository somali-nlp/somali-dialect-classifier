============================= test session starts ==============================
platform darwin -- Python 3.12.3, pytest-7.4.4, pluggy-1.6.0 -- /opt/anaconda3/bin/python
cachedir: .pytest_cache
rootdir: /Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier
configfile: pyproject.toml
plugins: anyio-4.11.0, timeout-2.4.0, cov-7.0.0
timeout: 300.0s
timeout method: signal
timeout func_only: False
collecting ... collected 643 items

tests/test_aggregation.py::TestVolumeWeightedAggregation::test_volume_weighted_vs_simple_average PASSED [  0%]
tests/test_aggregation.py::TestVolumeWeightedAggregation::test_harmonic_mean_penalizes_outliers PASSED [  0%]
tests/test_aggregation.py::TestVolumeWeightedAggregation::test_weighted_harmonic_mean PASSED [  0%]
tests/test_aggregation.py::TestVolumeWeightedAggregation::test_compatibility_validation_accepts_compatible_metrics PASSED [  0%]
tests/test_aggregation.py::TestVolumeWeightedAggregation::test_compatibility_validation_rejects_incompatible_metrics PASSED [  0%]
tests/test_aggregation.py::TestVolumeWeightedAggregation::test_compatibility_validation_allows_same_pipeline_type PASSED [  0%]
tests/test_aggregation.py::TestVolumeWeightedAggregation::test_handles_zero_records_gracefully PASSED [  1%]
tests/test_aggregation.py::TestVolumeWeightedAggregation::test_breakdown_shows_source_contributions PASSED [  1%]
tests/test_aggregation.py::TestVolumeWeightedAggregation::test_aggregation_methods PASSED [  1%]
tests/test_aggregation.py::TestVolumeWeightedAggregation::test_processing_json_format PASSED [  1%]
tests/test_aggregation.py::TestExtractMetrics::test_extract_from_flat_format PASSED [  1%]
tests/test_aggregation.py::TestExtractMetrics::test_extract_from_processing_json_format PASSED [  1%]
tests/test_aggregation.py::TestExtractMetrics::test_extract_handles_percentage_conversion PASSED [  2%]
tests/test_aggregation.py::TestAggregrateSummary::test_comprehensive_summary PASSED [  2%]
tests/test_aggregation.py::TestAggregrateSummary::test_summary_with_empty_sources PASSED [  2%]
tests/test_aggregation.py::TestRealWorldScenarios::test_real_data_bbc_wikipedia_hf PASSED [  2%]
tests/test_aggregation.py::TestRealWorldScenarios::test_phase0_vs_phase2_comparison PASSED [  2%]
tests/test_backup_system.py::test_backup_creation PASSED                 [  2%]
tests/test_backup_system.py::test_backup_checksums PASSED                [  2%]
tests/test_backup_system.py::test_backup_cleanup PASSED                  [  3%]
tests/test_backup_system.py::test_list_backups PASSED                    [  3%]
tests/test_backup_system.py::test_restore_basic XFAIL (Restore system
expects different directory structure)                                   [  3%]
tests/test_backup_system.py::test_restore_verification PASSED            [  3%]
tests/test_backup_system.py::test_restore_dry_run XFAIL (Restore system
expects different directory structure)                                   [  3%]
tests/test_backup_system.py::test_restore_list_backups PASSED            [  3%]
tests/test_backup_system.py::test_backup_with_missing_directories PASSED [  4%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_processor_implements_required_methods[WikipediaSomaliProcessor] PASSED [  4%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_processor_implements_required_methods[BBCSomaliProcessor] PASSED [  4%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_processor_implements_required_methods[HuggingFaceSomaliProcessor] PASSED [  4%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_processor_has_required_attributes[WikipediaSomaliProcessor] PASSED [  4%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_processor_has_required_attributes[BBCSomaliProcessor] PASSED [  4%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_processor_has_required_attributes[HuggingFaceSomaliProcessor] PASSED [  4%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_source_naming_convention[WikipediaSomaliProcessor] PASSED [  5%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_source_naming_convention[BBCSomaliProcessor] PASSED [  5%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_source_naming_convention[HuggingFaceSomaliProcessor] PASSED [  5%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_source_type_returns_string[WikipediaSomaliProcessor] PASSED [  5%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_source_type_returns_string[BBCSomaliProcessor] PASSED [  5%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_source_type_returns_string[HuggingFaceSomaliProcessor] PASSED [  5%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_license_returns_string[WikipediaSomaliProcessor] PASSED [  6%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_license_returns_string[BBCSomaliProcessor] PASSED [  6%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_license_returns_string[HuggingFaceSomaliProcessor] PASSED [  6%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_language_returns_iso_code[WikipediaSomaliProcessor] PASSED [  6%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_language_returns_iso_code[BBCSomaliProcessor] PASSED [  6%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_language_returns_iso_code[HuggingFaceSomaliProcessor] PASSED [  6%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_source_metadata_returns_dict[WikipediaSomaliProcessor] PASSED [  6%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_source_metadata_returns_dict[BBCSomaliProcessor] PASSED [  7%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_get_source_metadata_returns_dict[HuggingFaceSomaliProcessor] PASSED [  7%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_create_cleaner_returns_pipeline[WikipediaSomaliProcessor] PASSED [  7%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_create_cleaner_returns_pipeline[BBCSomaliProcessor] PASSED [  7%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_create_cleaner_returns_pipeline[HuggingFaceSomaliProcessor] PASSED [  7%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_extract_records_returns_iterator[WikipediaSomaliProcessor] PASSED [  7%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_extract_records_returns_iterator[BBCSomaliProcessor] PASSED [  8%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_extract_records_returns_iterator[HuggingFaceSomaliProcessor] PASSED [  8%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_directory_structure_uses_partitioning[WikipediaSomaliProcessor] PASSED [  8%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_directory_structure_uses_partitioning[BBCSomaliProcessor] PASSED [  8%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_directory_structure_uses_partitioning[HuggingFaceSomaliProcessor] PASSED [  8%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_process_returns_path[WikipediaSomaliProcessor] PASSED [  8%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_process_returns_path[BBCSomaliProcessor] PASSED [  9%]
tests/test_base_pipeline_contract.py::TestBasePipelineContract::test_process_returns_path[HuggingFaceSomaliProcessor] PASSED [  9%]
tests/test_base_pipeline_contract.py::TestRawRecord::test_raw_record_creation PASSED [  9%]
tests/test_base_pipeline_contract.py::TestRawRecord::test_raw_record_metadata_defaults_to_empty_dict PASSED [  9%]
tests/test_base_pipeline_contract.py::TestProcessorAdditionGuide::test_guide_exists PASSED [  9%]
tests/test_bbc_integration.py::TestBBCIntegration::test_process_from_fixture PASSED [  9%]
tests/test_bbc_integration.py::TestBBCIntegration::test_creates_silver_dataset FAILED [  9%]
tests/test_bbc_integration.py::TestBBCIntegration::test_html_cleaning_applied PASSED [ 10%]
tests/test_bbc_integration.py::TestBBCIntegration::test_metadata_preservation PASSED [ 10%]
tests/test_bbc_integration.py::TestBBCIntegration::test_empty_article_filtering PASSED [ 10%]
tests/test_bbc_integration.py::TestBBCIntegration::test_ids_unique PASSED [ 10%]
tests/test_bbc_integration.py::TestBBCIntegration::test_token_counts_positive PASSED [ 10%]
tests/test_bbc_integration.py::TestBBCIntegration::test_schema_consistency_with_wikipedia PASSED [ 10%]
tests/test_bbc_integration.py::TestBBCIntegration::test_scraper_empty_text_regression PASSED [ 11%]
tests/test_cli_e2e.py::TestWikipediaCLI::test_cli_imports_successfully PASSED [ 11%]
tests/test_cli_e2e.py::TestWikipediaCLI::test_cli_main_function_exists PASSED [ 11%]
tests/test_cli_e2e.py::TestWikipediaCLI::test_cli_help_output FAILED     [ 11%]
tests/test_cli_e2e.py::TestBBCCLI::test_cli_imports_successfully PASSED  [ 11%]
tests/test_cli_e2e.py::TestBBCCLI::test_cli_main_function_exists PASSED  [ 11%]
tests/test_cli_e2e.py::TestBBCCLI::test_cli_help_output PASSED           [ 11%]
tests/test_cli_e2e.py::TestCLILogging::test_wikipedia_cli_creates_log_file PASSED [ 12%]
tests/test_cli_e2e.py::TestCLILogging::test_bbc_cli_creates_log_file PASSED [ 12%]
tests/test_cli_e2e.py::TestCLIDataDirectories::test_wikipedia_creates_partitioned_directories FAILED [ 12%]
tests/test_cli_e2e.py::TestCLIDataDirectories::test_bbc_creates_partitioned_directories FAILED [ 12%]
tests/test_cli_e2e.py::TestCLIErrorHandling::test_wikipedia_handles_missing_dump_gracefully PASSED [ 12%]
tests/test_cli_e2e.py::TestCLIErrorHandling::test_bbc_handles_missing_staging_gracefully PASSED [ 12%]
tests/test_cli_e2e.py::TestCLIOutput::test_processors_have_consistent_logging_format FAILED [ 13%]
tests/test_cli_e2e.py::TestCLIIntegration::test_wikipedia_cli_full_pipeline_with_fixture FAILED [ 13%]
tests/test_cli_e2e.py::TestCLIIntegration::test_bbc_cli_full_pipeline_with_fixture PASSED [ 13%]
tests/test_cli_e2e.py::TestCLIDocumentation::test_wikipedia_cli_has_docstring PASSED [ 13%]
tests/test_cli_e2e.py::TestCLIDocumentation::test_bbc_cli_has_docstring PASSED [ 13%]
tests/test_cli_e2e.py::TestCLIDocumentation::test_cli_commands_registered_in_pyproject PASSED [ 13%]
tests/test_concurrent_runs.py::test_lock_prevents_concurrent_runs_same_source FAILED [ 13%]
tests/test_concurrent_runs.py::test_lock_allows_concurrent_runs_different_sources FAILED [ 14%]
tests/test_concurrent_runs.py::test_lock_automatic_release_on_exception PASSED [ 14%]
tests/test_concurrent_runs.py::test_cleanup_stale_locks PASSED           [ 14%]
tests/test_concurrent_runs.py::test_is_locked_detection PASSED           [ 14%]
tests/test_concurrent_runs.py::test_lock_file_creation PASSED            [ 14%]
tests/test_concurrent_runs.py::test_multiple_sources_locked_independently PASSED [ 14%]
tests/test_concurrent_runs.py::test_lock_timeout_error_message PASSED    [ 15%]
tests/test_concurrent_runs.py::test_lock_cleanup_preserves_recent_locks PASSED [ 15%]
tests/test_dashboard_calculation_unit.py::TestSuccessRateCalculation::test_actual_bug_scenario SKIPPEDnt) [ 15%]
tests/test_dashboard_calculation_unit.py::TestSuccessRateCalculation::test_discovery_stage_exclusion SKIPPEDnt) [ 15%]
tests/test_dashboard_calculation_unit.py::TestSuccessRateCalculation::test_simple_mean_calculation SKIPPEDnt) [ 15%]
tests/test_dashboard_calculation_unit.py::TestSuccessRateCalculation::test_weighted_mean_calculation SKIPPEDnt) [ 15%]
tests/test_dashboard_calculation_unit.py::TestSuccessRateCalculation::test_zero_records_handling SKIPPEDnt) [ 16%]
tests/test_dashboard_calculation_unit.py::TestMetricsFileSelection::test_processing_stage_filter SKIPPEDnt) [ 16%]
tests/test_dashboard_calculation_unit.py::TestEdgeCases::test_all_perfect_success_rates SKIPPEDnt) [ 16%]
tests/test_dashboard_calculation_unit.py::TestEdgeCases::test_rounding_behavior SKIPPEDnt) [ 16%]
tests/test_dashboard_calculation_unit.py::TestEdgeCases::test_single_failed_source SKIPPEDnt) [ 16%]
tests/test_dashboard_calculation_unit.py::TestEdgeCases::test_very_small_success_rate SKIPPEDnt) [ 16%]
tests/test_dashboard_calculation_unit.py::TestHealthyThreshold::test_healthy_threshold_95_percent SKIPPEDnt) [ 16%]
tests/test_dashboard_calculation_unit.py::TestRealData::test_real_processing_metrics SKIPPEDnt) [ 17%]
tests/test_dashboard_deployer.py::TestMetricsValidator::test_valid_metrics_file SKIPPEDnt) [ 17%]
tests/test_dashboard_deployer.py::TestMetricsValidator::test_invalid_metrics_missing_field SKIPPEDnt) [ 17%]
tests/test_dashboard_deployer.py::TestMetricsValidator::test_invalid_json SKIPPEDnt) [ 17%]
tests/test_dashboard_deployer.py::TestMetricsValidator::test_validate_all_metrics SKIPPEDnt) [ 17%]
tests/test_dashboard_deployer.py::TestGitOperations::test_check_git_available SKIPPEDnt) [ 17%]
tests/test_dashboard_deployer.py::TestGitOperations::test_is_git_repo SKIPPEDnt) [ 18%]
tests/test_dashboard_deployer.py::TestGitOperations::test_get_repo_status_non_repo SKIPPEDnt) [ 18%]
tests/test_dashboard_deployer.py::TestDeploymentConfig::test_default_config_creation SKIPPEDnt) [ 18%]
tests/test_dashboard_deployer.py::TestDeploymentConfig::test_custom_config SKIPPEDnt) [ 18%]
tests/test_dashboard_deployer.py::TestDashboardDeployer::test_deployer_initialization SKIPPEDnt) [ 18%]
tests/test_dashboard_deployer.py::TestDashboardDeployer::test_get_metrics_summary SKIPPEDnt) [ 18%]
tests/test_dashboard_deployer.py::TestDashboardDeployer::test_generate_commit_message SKIPPEDnt) [ 18%]
tests/test_deduplication_integration.py::TestDiscoveryStageDeduplication::test_ledger_tracks_processed_urls PASSED [ 19%]
tests/test_deduplication_integration.py::TestDiscoveryStageDeduplication::test_ledger_cross_run_deduplication PASSED [ 19%]
tests/test_deduplication_integration.py::TestDiscoveryStageDeduplication::test_force_flag_bypasses_deduplication PASSED [ 19%]
tests/test_deduplication_integration.py::TestHuggingFaceContinuousStreaming::test_checkpoint_creation_on_max_records PASSED [ 19%]
tests/test_deduplication_integration.py::TestHuggingFaceContinuousStreaming::test_no_extraction_complete_marker_on_max_records PASSED [ 19%]
tests/test_deduplication_integration.py::TestHuggingFaceContinuousStreaming::test_extraction_complete_marker_on_dataset_exhaustion PASSED [ 19%]
tests/test_deduplication_integration.py::TestLSHPersistence::test_lsh_index_persists_across_runs PASSED [ 20%]
tests/test_deduplication_integration.py::TestJSONLReplayDeduplication::test_process_phase_skips_processed_urls PASSED [ 20%]
tests/test_deduplication_integration.py::TestProcessorMetrics::test_discovery_dedup_metric_incremented SKIPPED) [ 20%]
tests/test_deduplication_integration.py::TestSprakbankenXMLTokenFix::test_token_element_extraction PASSED [ 20%]
tests/test_enhanced_schema.py::TestEnhancedSchema::test_schema_includes_new_fields PASSED [ 20%]
tests/test_enhanced_schema.py::TestEnhancedSchema::test_build_silver_record_with_domain PASSED [ 20%]
tests/test_enhanced_schema.py::TestEnhancedSchema::test_build_silver_record_without_domain_defaults PASSED [ 20%]
tests/test_enhanced_schema.py::TestEnhancedSchema::test_silver_writer_domain_inference SKIPPEDerDatasetWriter) [ 21%]
tests/test_enhanced_schema.py::TestEnhancedSchema::test_silver_writer_domain_validation SKIPPEDerDatasetWriter) [ 21%]
tests/test_enhanced_schema.py::TestEnhancedSchema::test_backward_compatibility_reading SKIPPEDerDatasetWriter) [ 21%]
tests/test_enhanced_schema.py::TestEnhancedSchema::test_domain_statistics SKIPPEDerDatasetWriter) [ 21%]
tests/test_enhanced_schema.py::TestEnhancedSchema::test_embedding_field_json_serialization SKIPPEDerDatasetWriter) [ 21%]
tests/test_enhanced_schema.py::TestDomainInference::test_infer_domain_bbc PASSED [ 21%]
tests/test_enhanced_schema.py::TestDomainInference::test_infer_domain_wikipedia PASSED [ 22%]
tests/test_enhanced_schema.py::TestDomainInference::test_infer_domain_huggingface PASSED [ 22%]
tests/test_enhanced_schema.py::TestDomainInference::test_infer_domain_sprakbankensom PASSED [ 22%]
tests/test_enhanced_schema.py::TestDomainInference::test_infer_domain_unknown PASSED [ 22%]
tests/test_file_dedup.py::TestFileChecksumComputation::test_checksum_deterministic PASSED [ 22%]
tests/test_file_dedup.py::TestFileChecksumComputation::test_checksum_different_content PASSED [ 22%]
tests/test_file_dedup.py::TestFileChecksumComputation::test_checksum_large_file_chunks PASSED [ 23%]
tests/test_file_dedup.py::TestDumpAlreadyProcessedCheck::test_dump_not_found_returns_none SKIPPED [ 23%]
tests/test_file_dedup.py::TestDumpAlreadyProcessedCheck::test_dump_already_processed_found SKIPPED [ 23%]
tests/test_file_dedup.py::TestDumpAlreadyProcessedCheck::test_checksum_mismatch_triggers_reprocess SKIPPED [ 23%]
tests/test_file_dedup.py::TestMetadataValidation::test_validate_complete_metadata SKIPPED [ 23%]
tests/test_file_dedup.py::TestMetadataValidation::test_validate_missing_fields SKIPPED [ 23%]
tests/test_file_dedup.py::TestMetadataValidation::test_validate_corrupted_json SKIPPED [ 23%]
tests/test_file_dedup.py::TestSprakbankenBatchSignature::test_batch_signature_deterministic SKIPPEDocessor) [ 24%]
tests/test_file_dedup.py::TestSprakbankenBatchSignature::test_batch_signature_order_independent SKIPPEDocessor) [ 24%]
tests/test_file_dedup.py::TestConcurrentRunCoordination::test_lock_prevents_concurrent_processing PASSED [ 24%]
tests/test_file_dedup.py::TestConcurrentRunCoordination::test_stale_lock_removed PASSED [ 24%]
tests/test_file_dedup_performance.py::TestChecksumPerformance::test_checksum_small_file PASSED [ 24%]
tests/test_file_dedup_performance.py::TestChecksumPerformance::test_checksum_production_size PASSED [ 24%]
tests/test_file_dedup_performance.py::TestChecksumPerformance::test_checksum_large_file_stress PASSED [ 25%]
tests/test_file_dedup_performance.py::TestChecksumPerformance::test_metadata_search_scaling SKIPPED [ 25%]
tests/test_filters.py::TestMinLengthFilter::test_passes_long_text PASSED [ 25%]
tests/test_filters.py::TestMinLengthFilter::test_rejects_short_text PASSED [ 25%]
tests/test_filters.py::TestMinLengthFilter::test_exactly_at_threshold PASSED [ 25%]
tests/test_filters.py::TestMinLengthFilter::test_one_below_threshold PASSED [ 25%]
tests/test_filters.py::TestMinLengthFilter::test_custom_threshold PASSED [ 25%]
tests/test_filters.py::TestMinLengthFilter::test_empty_string PASSED     [ 26%]
tests/test_filters.py::TestLangidFilter::test_detects_somali_text PASSED [ 26%]
tests/test_filters.py::TestLangidFilter::test_rejects_english_text PASSED [ 26%]
tests/test_filters.py::TestLangidFilter::test_enriches_metadata_with_language PASSED [ 26%]
tests/test_filters.py::TestLangidFilter::test_confidence_threshold PASSED [ 26%]
tests/test_filters.py::TestLangidFilter::test_multiple_allowed_languages PASSED [ 26%]
tests/test_filters.py::TestLangidFilter::test_very_short_text PASSED     [ 27%]
tests/test_filters.py::TestDialectHeuristicFilter::test_enriches_with_topic_markers PASSED [ 27%]
tests/test_filters.py::TestDialectHeuristicFilter::test_identifies_primary_dialect PASSED [ 27%]
tests/test_filters.py::TestDialectHeuristicFilter::test_enrich_only_mode_always_passes PASSED [ 27%]
tests/test_filters.py::TestDialectHeuristicFilter::test_filter_mode_rejects_without_markers PASSED [ 27%]
tests/test_filters.py::TestDialectHeuristicFilter::test_filter_mode_passes_with_markers PASSED [ 27%]
tests/test_filters.py::TestDialectHeuristicFilter::test_case_insensitive_matching PASSED [ 27%]
tests/test_filters.py::TestDialectHeuristicFilter::test_empty_ruleset PASSED [ 28%]
tests/test_filters.py::TestDialectHeuristicFilter::test_multiple_markers_in_text PASSED [ 28%]
tests/test_filters.py::TestNamespaceFilter::test_rejects_talk_pages PASSED [ 28%]
tests/test_filters.py::TestNamespaceFilter::test_rejects_user_pages PASSED [ 28%]
tests/test_filters.py::TestNamespaceFilter::test_passes_regular_articles PASSED [ 28%]
tests/test_filters.py::TestNamespaceFilter::test_checks_all_prefixes PASSED [ 28%]
tests/test_filters.py::TestNamespaceFilter::test_empty_skip_list PASSED  [ 29%]
tests/test_filters.py::TestCustomFilter::test_simple_predicate PASSED    [ 29%]
tests/test_filters.py::TestCustomFilter::test_predicate_with_value PASSED [ 29%]
tests/test_filters.py::TestCustomFilter::test_predicate_returning_none_value PASSED [ 29%]
tests/test_filters.py::TestConvenienceConstructors::test_create_wikipedia_filters PASSED [ 29%]
tests/test_filters.py::TestConvenienceConstructors::test_create_wikipedia_filters_custom_threshold PASSED [ 29%]
tests/test_filters.py::TestConvenienceConstructors::test_create_news_filters PASSED [ 30%]
tests/test_filters.py::TestConvenienceConstructors::test_create_news_filters_with_dialect_ruleset FAILED [ 30%]
tests/test_filters.py::TestConvenienceConstructors::test_create_hf_filters PASSED [ 30%]
tests/test_filters.py::TestFilterIntegration::test_filter_chain_execution PASSED [ 30%]
tests/test_filters.py::TestFilterIntegration::test_short_circuit_on_first_failure PASSED [ 30%]
tests/test_force_reprocessing.py::TestForceReprocessing::test_process_skips_existing_file_by_default SKIPPED [ 30%]
tests/test_force_reprocessing.py::TestForceReprocessing::test_process_with_force_flag_reprocesses SKIPPED [ 30%]
tests/test_force_reprocessing.py::TestForceReprocessing::test_extract_skips_existing_staging_by_default SKIPPED [ 31%]
tests/test_force_reprocessing.py::TestBBCCacheInvalidation::test_bbc_reuses_cache_with_same_parameters SKIPPED [ 31%]
tests/test_force_reprocessing.py::TestBBCCacheInvalidation::test_bbc_invalidates_cache_on_parameter_change SKIPPED [ 31%]
tests/test_force_reprocessing.py::TestBBCCacheInvalidation::test_bbc_force_flag_rediscovers_articles SKIPPED [ 31%]
tests/test_force_reprocessing.py::TestForceParameter::test_force_parameter_passed_to_base_pipeline SKIPPED [ 31%]
tests/test_force_reprocessing.py::TestForceParameter::test_all_processors_support_force_parameter SKIPPED [ 31%]
tests/test_foundation.py::TestCrawlLedger::test_ledger_initialization PASSED [ 32%]
tests/test_foundation.py::TestCrawlLedger::test_discover_url PASSED      [ 32%]
tests/test_foundation.py::TestCrawlLedger::test_mark_fetched PASSED      [ 32%]
tests/test_foundation.py::TestCrawlLedger::test_mark_processed PASSED    [ 32%]
tests/test_foundation.py::TestCrawlLedger::test_duplicate_detection PASSED [ 32%]
tests/test_foundation.py::TestCrawlLedger::test_rss_throttling PASSED    [ 32%]
tests/test_foundation.py::TestCrawlLedger::test_statistics PASSED        [ 32%]
tests/test_foundation.py::TestDeduplication::test_text_hasher PASSED     [ 33%]
tests/test_foundation.py::TestDeduplication::test_text_hasher_with_url PASSED [ 33%]
tests/test_foundation.py::TestDeduplication::test_exact_deduplication PASSED [ 33%]
tests/test_foundation.py::TestDeduplication::test_near_duplicate_detection SKIPPEDsimilar) [ 33%]
tests/test_foundation.py::TestMetrics::test_metrics_collector PASSED     [ 33%]
tests/test_foundation.py::TestMetrics::test_metrics_statistics PASSED    [ 33%]
tests/test_foundation.py::TestMetrics::test_quality_reporter PASSED      [ 34%]
tests/test_foundation.py::TestStructuredLogging::test_run_id_generation PASSED [ 34%]
tests/test_foundation.py::TestStructuredLogging::test_context_management PASSED [ 34%]
tests/test_foundation.py::TestStructuredLogging::test_timer PASSED       [ 34%]
tests/test_foundation.py::TestStructuredLogging::test_structured_logger PASSED [ 34%]
tests/test_foundation.py::test_full_pipeline_integration PASSED          [ 34%]
tests/test_hf_integration.py::TestHuggingFaceSomaliProcessor::test_processor_initialization SKIPPEDd engineer) [ 34%]
tests/test_hf_integration.py::TestHuggingFaceSomaliProcessor::test_manifest_creation SKIPPEDd engineer) [ 35%]
tests/test_hf_integration.py::TestHuggingFaceSomaliProcessor::test_field_mapping SKIPPEDd engineer) [ 35%]
tests/test_hf_integration.py::TestHuggingFaceSomaliProcessor::test_title_generation_from_text SKIPPEDd engineer) [ 35%]
tests/test_hf_integration.py::TestHuggingFaceSomaliProcessor::test_url_generation_if_missing SKIPPEDd engineer) [ 35%]
tests/test_hf_integration.py::TestHuggingFaceSomaliProcessor::test_batch_writing SKIPPEDd engineer) [ 35%]
tests/test_hf_integration.py::TestHuggingFaceSomaliProcessor::test_filters_are_registered SKIPPEDd engineer) [ 35%]
tests/test_hf_integration.py::TestHuggingFaceSomaliProcessor::test_source_type_inference SKIPPEDd engineer) [ 36%]
tests/test_hf_integration.py::TestHuggingFaceSomaliProcessor::test_license_inference SKIPPEDd engineer) [ 36%]
tests/test_hf_integration.py::TestHFFactoryFunctions::test_create_mc4_processor SKIPPEDd engineer) [ 36%]
tests/test_hf_integration.py::TestHFIntegration::test_mc4_integration_small_sample SKIPPED [ 36%]
tests/test_hf_integration.py::TestHFIntegration::test_resume_capability SKIPPEDd engineer) [ 36%]
tests/test_hf_integration.py::TestHFConfiguration::test_config_values_used SKIPPEDd engineer) [ 36%]
tests/test_hf_integration.py::TestHFConfiguration::test_filter_threshold_from_config SKIPPEDd engineer) [ 37%]
tests/test_hf_integration.py::TestHFErrorHandling::test_missing_text_field SKIPPEDd engineer) [ 37%]
tests/test_hf_integration.py::TestHFErrorHandling::test_extraction_without_download SKIPPEDd engineer) [ 37%]
tests/test_hf_integration.py::TestHFErrorHandling::test_process_without_extract SKIPPEDd engineer) [ 37%]
tests/test_hf_processor.py::TestHFProcessorFiles::test_processed_file_is_set SKIPPED [ 37%]
tests/test_hf_processor.py::TestHFProcessorFiles::test_manifest_uses_dataset_slug SKIPPED [ 37%]
tests/test_hf_processor.py::TestHFProcessorFiles::test_processed_file_written_after_process SKIPPED [ 37%]
tests/test_hf_processor.py::TestHFProcessorFiles::test_manifest_contains_audit_metadata SKIPPED [ 38%]
tests/test_hf_processor.py::TestHFProcessorFiles::test_process_always_returns_path_or_raises SKIPPED [ 38%]
tests/test_hf_processor.py::TestHFProcessorFiles::test_process_raises_on_empty_results SKIPPED [ 38%]
tests/test_incremental_processing.py::TestLedgerIncrementalMethods::test_get_last_processing_time_first_run PASSED [ 38%]
tests/test_incremental_processing.py::TestLedgerIncrementalMethods::test_get_last_processing_time_after_processing PASSED [ 38%]
tests/test_incremental_processing.py::TestLedgerIncrementalMethods::test_get_processed_urls PASSED [ 38%]
tests/test_incremental_processing.py::TestWikipediaIncrementalProcessing::test_first_run_processes_all PASSED [ 39%]
tests/test_incremental_processing.py::TestWikipediaIncrementalProcessing::test_subsequent_run_filters_old PASSED [ 39%]
tests/test_incremental_processing.py::TestWikipediaIncrementalProcessing::test_no_new_records_skips_all PASSED [ 39%]
tests/test_incremental_processing.py::TestWikipediaIncrementalProcessing::test_invalid_timestamps_processed PASSED [ 39%]
tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_extract_corpus_id_from_korp_url ERROR [ 39%]
tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_extract_corpus_id_from_download_url ERROR [ 39%]
tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_first_run_processes_all_corpora ERROR [ 39%]
tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_subsequent_run_filters_processed_corpora ERROR [ 40%]
tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_all_corpora_processed_skips_all ERROR [ 40%]
tests/test_incremental_processing.py::TestIncrementalProcessingMetrics::test_wikipedia_incremental_metrics PASSED [ 40%]
tests/test_incremental_processing.py::TestIncrementalProcessingMetrics::test_sprakbanken_incremental_metrics ERROR [ 40%]
tests/test_incremental_processing.py::TestFailSafeBehavior::test_ledger_unavailable_processes_all PASSED [ 40%]
tests/test_incremental_processing.py::TestFailSafeBehavior::test_query_error_returns_empty_set ERROR [ 40%]
tests/test_ledger_incremental.py::TestGetLastProcessingTime::test_returns_none_for_new_source PASSED [ 41%]
tests/test_ledger_incremental.py::TestGetLastProcessingTime::test_returns_none_when_no_processed_urls PASSED [ 41%]
tests/test_ledger_incremental.py::TestGetLastProcessingTime::test_returns_timestamp_after_processing PASSED [ 41%]
tests/test_ledger_incremental.py::TestGetLastProcessingTime::test_returns_most_recent_timestamp PASSED [ 41%]
tests/test_ledger_incremental.py::TestGetLastProcessingTime::test_ignores_non_processed_states PASSED [ 41%]
tests/test_ledger_incremental.py::TestGetLastProcessingTime::test_source_isolation PASSED [ 41%]
tests/test_ledger_incremental.py::TestGetProcessedUrls::test_returns_empty_list_for_new_source PASSED [ 41%]
tests/test_ledger_incremental.py::TestGetProcessedUrls::test_returns_only_processed_urls PASSED [ 42%]
tests/test_ledger_incremental.py::TestGetProcessedUrls::test_respects_limit_parameter PASSED [ 42%]
tests/test_ledger_incremental.py::TestGetProcessedUrls::test_returns_url_metadata PASSED [ 42%]
tests/test_ledger_incremental.py::TestGetProcessedUrls::test_source_isolation PASSED [ 42%]
tests/test_ledger_incremental.py::TestIncrementalProcessingWorkflow::test_wikipedia_quarterly_refresh_scenario PASSED [ 42%]
tests/test_ledger_incremental.py::TestIncrementalProcessingWorkflow::test_sprakbanken_incremental_corpus_scenario PASSED [ 42%]
tests/test_metrics_consolidation.py::TestPhase3SchemaValidation::test_valid_processing_json SKIPPED [ 43%]
tests/test_metrics_consolidation.py::TestPhase3SchemaValidation::test_missing_required_field SKIPPED [ 43%]
tests/test_metrics_consolidation.py::TestPhase3SchemaValidation::test_invalid_schema_version SKIPPED [ 43%]
tests/test_metrics_consolidation.py::TestPhase3SchemaValidation::test_layered_metrics_validation SKIPPED [ 43%]
tests/test_metrics_consolidation.py::TestPhase3SchemaValidation::test_statistics_validation SKIPPED [ 43%]
tests/test_metrics_consolidation.py::TestConsolidatedMetricExtraction::test_extract_consolidated_metric SKIPPED [ 43%]
tests/test_metrics_consolidation.py::TestConsolidatedMetricExtraction::test_null_source_guard SKIPPED [ 44%]
tests/test_metrics_consolidation.py::TestConsolidatedMetricExtraction::test_filter_breakdown_extraction SKIPPED [ 44%]
tests/test_metrics_consolidation.py::TestConsolidatedMetricExtraction::test_throughput_metrics_extraction SKIPPED [ 44%]
tests/test_metrics_consolidation.py::TestConsolidatedMetricValidation::test_valid_consolidated_metric SKIPPED [ 44%]
tests/test_metrics_consolidation.py::TestConsolidatedMetricValidation::test_consolidated_metrics_output_validation SKIPPED [ 44%]
tests/test_metrics_consolidation.py::TestConsolidatedMetricValidation::test_negative_values_rejected SKIPPED [ 44%]
tests/test_metrics_consolidation.py::TestConsolidatedMetricValidation::test_rate_bounds_validation SKIPPED [ 44%]
tests/test_metrics_consolidation.py::TestDashboardSummaryGeneration::test_summary_from_empty_metrics SKIPPED [ 45%]
tests/test_metrics_consolidation.py::TestDashboardSummaryGeneration::test_summary_from_single_metric SKIPPED [ 45%]
tests/test_metrics_consolidation.py::TestDashboardSummaryGeneration::test_summary_source_breakdown SKIPPED [ 45%]
tests/test_metrics_consolidation.py::TestDashboardSummaryGeneration::test_summary_validation SKIPPED [ 45%]
tests/test_metrics_consolidation.py::TestEdgeCases::test_missing_layered_metrics SKIPPED [ 45%]
tests/test_metrics_consolidation.py::TestEdgeCases::test_empty_filter_breakdown SKIPPED [ 45%]
tests/test_metrics_consolidation.py::TestEdgeCases::test_missing_optional_stats SKIPPED [ 46%]
tests/test_metrics_consolidation.py::TestEdgeCases::test_zero_division_in_summary SKIPPED [ 46%]
tests/test_metrics_consolidation.py::TestSchemaContract::test_required_fields_in_consolidated_metric SKIPPED [ 46%]
tests/test_metrics_consolidation.py::TestSchemaContract::test_deprecated_metrics_excluded SKIPPED [ 46%]
tests/test_metrics_phase1.py::TestWebScrapingMetrics::test_bbc_metrics_semantic_accuracy PASSED [ 46%]
tests/test_metrics_phase1.py::TestWebScrapingMetrics::test_bbc_test_limit_bug_fix PASSED [ 46%]
tests/test_metrics_phase1.py::TestFileProcessingMetrics::test_wikipedia_metrics_semantic_accuracy PASSED [ 46%]
tests/test_metrics_phase1.py::TestFileProcessingMetrics::test_file_processing_no_files_tracked PASSED [ 47%]
tests/test_metrics_phase1.py::TestStreamProcessingMetrics::test_huggingface_metrics_semantic_accuracy PASSED [ 47%]
tests/test_metrics_phase1.py::TestStreamProcessingMetrics::test_stream_connection_failure PASSED [ 47%]
tests/test_metrics_phase1.py::TestMetricSemantics::test_all_pipelines_have_semantics PASSED [ 47%]
tests/test_metrics_phase1.py::TestMetricSemantics::test_semantic_descriptions_are_helpful PASSED [ 47%]
tests/test_metrics_phase1.py::TestBackwardCompatibility::test_old_metrics_still_available PASSED [ 47%]
tests/test_metrics_phase1.py::TestBackwardCompatibility::test_quality_pass_rate_unchanged PASSED [ 48%]
tests/test_metrics_phase1.py::test_demonstration_output PASSED           [ 48%]
tests/test_metrics_phase2_phase3.py::TestLayeredMetricsArchitecture::test_layered_metrics_structure SKIPPEDnt) [ 48%]
tests/test_metrics_phase2_phase3.py::TestLayeredMetricsArchitecture::test_connectivity_layer SKIPPEDnt) [ 48%]
tests/test_metrics_phase2_phase3.py::TestLayeredMetricsArchitecture::test_extraction_layer_web_scraping SKIPPEDnt) [ 48%]
tests/test_metrics_phase2_phase3.py::TestLayeredMetricsArchitecture::test_extraction_layer_file_processing SKIPPEDnt) [ 48%]
tests/test_metrics_phase2_phase3.py::TestLayeredMetricsArchitecture::test_extraction_layer_stream_processing SKIPPEDnt) [ 48%]
tests/test_metrics_phase2_phase3.py::TestLayeredMetricsArchitecture::test_quality_layer SKIPPEDnt) [ 49%]
tests/test_metrics_phase2_phase3.py::TestLayeredMetricsArchitecture::test_volume_layer SKIPPEDnt) [ 49%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_connectivity_validation_success SKIPPEDnt) [ 49%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_connectivity_validation_negative_duration SKIPPEDnt) [ 49%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_connectivity_validation_success_without_attempt SKIPPEDnt) [ 49%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_web_scraping_validation_success SKIPPEDnt) [ 49%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_web_scraping_validation_successful_exceeds_attempted SKIPPEDnt) [ 50%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_web_scraping_validation_extracted_exceeds_parsed SKIPPEDnt) [ 50%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_file_processing_validation_success SKIPPEDnt) [ 50%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_file_processing_validation_processed_exceeds_discovered SKIPPEDnt) [ 50%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_stream_processing_validation_success SKIPPEDnt) [ 50%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_stream_validation_records_without_stream SKIPPEDnt) [ 50%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_quality_validation_success SKIPPEDnt) [ 51%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_quality_validation_passed_exceeds_received SKIPPEDnt) [ 51%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_volume_validation_success SKIPPEDnt) [ 51%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_volume_validation_negative_values SKIPPEDnt) [ 51%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_cross_layer_validation SKIPPEDnt) [ 51%]
tests/test_metrics_phase2_phase3.py::TestMetricValidation::test_cross_layer_validation_volume_exceeds_quality SKIPPEDnt) [ 51%]
tests/test_metrics_phase2_phase3.py::TestFactoryFunctions::test_factory_creates_web_scraping_metrics SKIPPEDnt) [ 51%]
tests/test_metrics_phase2_phase3.py::TestFactoryFunctions::test_factory_creates_file_processing_metrics SKIPPEDnt) [ 52%]
tests/test_metrics_phase2_phase3.py::TestFactoryFunctions::test_factory_creates_stream_processing_metrics SKIPPEDnt) [ 52%]
tests/test_metrics_phase2_phase3.py::TestFactoryFunctions::test_factory_accepts_string_pipeline_type SKIPPEDnt) [ 52%]
tests/test_metrics_phase2_phase3.py::TestFactoryFunctions::test_factory_raises_on_invalid_pipeline_type SKIPPEDnt) [ 52%]
tests/test_metrics_phase2_phase3.py::TestSchemaVersioning::test_json_export_includes_schema_version SKIPPEDnt) [ 52%]
tests/test_metrics_phase2_phase3.py::TestSchemaVersioning::test_json_export_includes_pipeline_type SKIPPEDnt) [ 52%]
tests/test_metrics_phase2_phase3.py::TestSchemaVersioning::test_json_export_includes_layered_metrics SKIPPEDnt) [ 53%]
tests/test_metrics_phase2_phase3.py::TestSchemaVersioning::test_json_export_includes_legacy_metrics SKIPPEDnt) [ 53%]
tests/test_metrics_phase2_phase3.py::TestSchemaVersioning::test_json_export_can_exclude_layered_metrics SKIPPEDnt) [ 53%]
tests/test_metrics_phase2_phase3.py::TestSchemaVersioning::test_json_export_validation_warnings SKIPPEDnt) [ 53%]
tests/test_metrics_phase2_phase3.py::TestPrometheusExport::test_prometheus_export_creates_file SKIPPEDnt) [ 53%]
tests/test_metrics_phase2_phase3.py::TestPrometheusExport::test_prometheus_export_includes_help_and_type SKIPPEDnt) [ 53%]
tests/test_metrics_phase2_phase3.py::TestPrometheusExport::test_prometheus_export_includes_labels SKIPPEDnt) [ 53%]
tests/test_metrics_phase2_phase3.py::TestPrometheusExport::test_prometheus_export_connectivity_metrics SKIPPEDnt) [ 54%]
tests/test_metrics_phase2_phase3.py::TestPrometheusExport::test_prometheus_export_web_scraping_metrics SKIPPEDnt) [ 54%]
tests/test_metrics_phase2_phase3.py::TestPrometheusExport::test_prometheus_export_file_processing_metrics SKIPPEDnt) [ 54%]
tests/test_metrics_phase2_phase3.py::TestPrometheusExport::test_prometheus_export_stream_processing_metrics SKIPPEDnt) [ 54%]
tests/test_metrics_phase2_phase3.py::TestPrometheusExport::test_prometheus_export_quality_metrics SKIPPEDnt) [ 54%]
tests/test_metrics_phase2_phase3.py::TestPrometheusExport::test_prometheus_export_volume_metrics SKIPPEDnt) [ 54%]
tests/test_metrics_phase2_phase3.py::TestBackwardCompatibility::test_legacy_metrics_still_available SKIPPEDnt) [ 55%]
tests/test_metrics_phase2_phase3.py::TestBackwardCompatibility::test_phase1_tests_still_pass SKIPPEDnt) [ 55%]
tests/test_metrics_phase2_phase3.py::test_demonstration_output_phase2_phase3 SKIPPEDnt) [ 55%]
tests/test_record_utils.py::TestHashGeneration::test_text_hash_deterministic PASSED [ 55%]
tests/test_record_utils.py::TestHashGeneration::test_text_hash_different PASSED [ 55%]
tests/test_record_utils.py::TestHashGeneration::test_text_hash_length PASSED [ 55%]
tests/test_record_utils.py::TestHashGeneration::test_record_id_deterministic PASSED [ 55%]
tests/test_record_utils.py::TestHashGeneration::test_record_id_different PASSED [ 56%]
tests/test_record_utils.py::TestTokenCounting::test_count_tokens_simple PASSED [ 56%]
tests/test_record_utils.py::TestTokenCounting::test_count_tokens_empty PASSED [ 56%]
tests/test_record_utils.py::TestTokenCounting::test_count_tokens_multiple_spaces PASSED [ 56%]
tests/test_record_utils.py::TestBuildSilverRecord::test_build_record_minimal PASSED [ 56%]
tests/test_record_utils.py::TestBuildSilverRecord::test_build_record_with_metadata PASSED [ 56%]
tests/test_record_utils.py::TestBuildSilverRecord::test_build_record_defaults PASSED [ 57%]
tests/test_silver_writer.py::TestSilverDatasetWriter::test_write_enforces_schema SKIPPEDerDatasetWriter) [ 57%]
tests/test_silver_writer.py::TestSilverDatasetWriter::test_metadata_json_serialization SKIPPEDerDatasetWriter) [ 57%]
tests/test_silver_writer.py::TestSilverDatasetWriter::test_multiple_sources_no_schema_drift SKIPPEDerDatasetWriter) [ 57%]
tests/test_silver_writer.py::TestSilverDatasetWriter::test_read_back_after_write SKIPPEDerDatasetWriter) [ 57%]
tests/test_silver_writer.py::TestSilverDatasetWriter::test_empty_records_returns_none PASSED [ 57%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_processor_initialization SKIPPED [ 58%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_processor_all_corpora SKIPPED [ 58%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_invalid_corpus_id SKIPPED [ 58%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_get_domain SKIPPED [ 58%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_extract_sentence_text SKIPPED [ 58%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_extract_text_metadata SKIPPED [ 58%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_download_manifest_creation SKIPPED [ 58%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_extract_corpus_xml_parsing SKIPPED [ 59%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_extract_records_iteration SKIPPED [ 59%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenSomaliProcessor::test_processor_filters SKIPPED [ 59%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenHelperFunctions::test_list_available_corpora SKIPPED [ 59%]
tests/test_sprakbanken_somali_processor.py::TestSprakbankenHelperFunctions::test_get_corpus_info SKIPPED [ 59%]
tests/test_sprakbanken_somali_processor.py::TestCorpusMetadata::test_all_corpora_have_domain SKIPPED [ 59%]
tests/test_sprakbanken_somali_processor.py::TestCorpusMetadata::test_corpus_metadata_consistency SKIPPED [ 60%]
tests/test_text_cleaners.py::TestWikiMarkupCleaner::test_link_with_display_text PASSED [ 60%]
tests/test_text_cleaners.py::TestWikiMarkupCleaner::test_simple_link PASSED [ 60%]
tests/test_text_cleaners.py::TestWikiMarkupCleaner::test_remove_templates PASSED [ 60%]
tests/test_text_cleaners.py::TestWikiMarkupCleaner::test_remove_references PASSED [ 60%]
tests/test_text_cleaners.py::TestWikiMarkupCleaner::test_remove_headings PASSED [ 60%]
tests/test_text_cleaners.py::TestWhitespaceCleaner::test_collapse_newlines PASSED [ 60%]
tests/test_text_cleaners.py::TestWhitespaceCleaner::test_collapse_spaces PASSED [ 61%]
tests/test_text_cleaners.py::TestWhitespaceCleaner::test_strip_whitespace PASSED [ 61%]
tests/test_text_cleaners.py::TestTextCleaningPipeline::test_pipeline_composition PASSED [ 61%]
tests/test_text_cleaners.py::TestTextCleaningPipeline::test_minimum_length_filter PASSED [ 61%]
tests/test_text_cleaners.py::TestTextCleaningPipeline::test_minimum_length_pass PASSED [ 61%]
tests/test_text_cleaners.py::TestHTMLCleaner::test_remove_html_tags PASSED [ 61%]
tests/test_text_cleaners.py::TestHTMLCleaner::test_decode_html_entities PASSED [ 62%]
tests/test_text_cleaners.py::TestHTMLCleaner::test_decode_common_entities PASSED [ 62%]
tests/test_text_cleaners.py::TestHTMLCleaner::test_remove_tags_and_decode_entities PASSED [ 62%]
tests/test_text_cleaners.py::TestHTMLCleaner::test_bbc_article_like_html PASSED [ 62%]
tests/test_text_cleaners.py::TestWikipediaCleanerFactory::test_create_wikipedia_cleaner PASSED [ 62%]
tests/test_text_cleaners.py::TestWikipediaCleanerFactory::test_wikipedia_cleaner_end_to_end PASSED [ 62%]
tests/test_text_cleaners.py::TestHTMLCleanerFactory::test_create_html_cleaner PASSED [ 62%]
tests/test_text_cleaners.py::TestHTMLCleanerFactory::test_html_cleaner_end_to_end PASSED [ 63%]
tests/test_text_cleaners.py::TestHTMLCleanerFactory::test_html_cleaner_min_length_filter PASSED [ 63%]
tests/test_text_cleaners.py::TestHTMLCleanerFactory::test_html_cleaner_pass_length_filter PASSED [ 63%]
tests/test_wikipedia_integration.py::TestWikipediaIntegration::test_extract_from_fixture SKIPPED [ 63%]
tests/test_wikipedia_integration.py::TestWikipediaIntegration::test_process_creates_silver_dataset SKIPPED [ 63%]
tests/test_wikipedia_integration.py::TestWikipediaIntegration::test_text_cleaning_applied SKIPPED [ 63%]
tests/test_wikipedia_integration.py::TestWikipediaIntegration::test_record_ids_are_unique SKIPPED [ 64%]
tests/test_wikipedia_integration.py::TestWikipediaIntegration::test_full_pipeline_run_method SKIPPED [ 64%]
tests/test_wikipedia_integration.py::TestWikipediaIntegration::test_idempotency SKIPPED [ 64%]
tests/database/test_backend_compatibility.py::TestBackendAPIs::test_discover_url_sqlite PASSED [ 64%]
tests/database/test_backend_compatibility.py::TestBackendAPIs::test_discover_url_postgres ERROR [ 64%]
tests/database/test_backend_compatibility.py::TestBackendAPIs::test_mark_fetched_sqlite PASSED [ 64%]
tests/database/test_backend_compatibility.py::TestBackendAPIs::test_mark_fetched_postgres ERROR [ 65%]
tests/database/test_backend_compatibility.py::TestBackendAPIs::test_mark_processed_sqlite PASSED [ 65%]
tests/database/test_backend_compatibility.py::TestBackendAPIs::test_mark_processed_postgres ERROR [ 65%]
tests/database/test_backend_compatibility.py::TestBackendAPIs::test_is_duplicate_sqlite PASSED [ 65%]
tests/database/test_backend_compatibility.py::TestBackendAPIs::test_is_duplicate_postgres ERROR [ 65%]
tests/database/test_backend_compatibility.py::TestBackendSelection::test_explicit_sqlite_backend PASSED [ 65%]
tests/database/test_backend_compatibility.py::TestBackendSelection::test_explicit_postgres_backend FAILED [ 65%]
tests/database/test_backend_compatibility.py::TestBackendSelection::test_environment_variable_backend_selection PASSED [ 66%]
tests/database/test_backend_compatibility.py::TestBackendSelection::test_invalid_backend_type PASSED [ 66%]
tests/database/test_backend_compatibility.py::TestBackendBehaviorParity::test_statistics_parity PASSED [ 66%]
tests/database/test_backend_compatibility.py::TestBackendBehaviorParity::test_statistics_parity_postgres ERROR [ 66%]
tests/database/test_backend_compatibility.py::TestBackendBehaviorParity::test_get_pending_urls_sqlite PASSED [ 66%]
tests/database/test_backend_compatibility.py::TestBackendBehaviorParity::test_get_pending_urls_postgres ERROR [ 66%]
tests/database/test_load_postgres.py::TestConcurrentWrites::test_5_concurrent_sources ERROR [ 67%]
tests/database/test_load_postgres.py::TestConcurrentWrites::test_10x_concurrent_writes ERROR [ 67%]
tests/database/test_load_postgres.py::TestQueryPerformance::test_concurrent_reads_and_writes ERROR [ 67%]
tests/database/test_load_postgres.py::TestQueryPerformance::test_bulk_operations ERROR [ 67%]
tests/database/test_load_postgres.py::TestConnectionPooling::test_connection_pool_exhaustion ERROR [ 67%]
tests/database/test_load_postgres.py::TestStressScenarios::test_rapid_state_transitions ERROR [ 67%]
tests/database/test_load_postgres.py::TestStressScenarios::test_concurrent_duplicate_detection ERROR [ 67%]
tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_connection_pool_creation ERROR [ 68%]
tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_schema_initialization ERROR [ 68%]
tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_upsert_url_insert ERROR [ 68%]
tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_upsert_url_update ERROR [ 68%]
tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_get_urls_by_state ERROR [ 68%]
tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_mark_url_state ERROR [ 68%]
tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_check_duplicate_by_hash ERROR [ 69%]
tests/database/test_postgres_ledger.py::TestPostgresConcurrency::test_concurrent_writes_10_threads ERROR [ 69%]
tests/database/test_postgres_ledger.py::TestPostgresConcurrency::test_concurrent_writes_50_threads ERROR [ 69%]
tests/database/test_postgres_ledger.py::TestPostgresPerformance::test_query_latency ERROR [ 69%]
tests/database/test_postgres_ledger.py::TestPostgresPerformance::test_bulk_insert_performance ERROR [ 69%]
tests/database/test_postgres_ledger.py::TestPostgresStatistics::test_get_statistics ERROR [ 69%]
tests/database/test_postgres_ledger.py::TestPostgresRSSFeed::test_record_rss_fetch ERROR [ 69%]
tests/database/test_postgres_ledger.py::TestPostgresRSSFeed::test_should_fetch_rss ERROR [ 70%]
tests/database/test_postgres_ledger.py::TestPostgresCleanup::test_cleanup_old_entries ERROR [ 70%]
tests/database/test_postgres_ledger.py::TestPostgresCleanup::test_connection_pool_close ERROR [ 70%]
tests/integration/test_bbc_processor_integration.py::TestBBCProcessorInitialization::test_processor_initializes_with_defaults PASSED [ 70%]
tests/integration/test_bbc_processor_integration.py::TestBBCProcessorInitialization::test_processor_initializes_with_custom_params PASSED [ 70%]
tests/integration/test_bbc_processor_integration.py::TestBBCProcessorInitialization::test_processor_has_dedup_engine PASSED [ 70%]
tests/integration/test_bbc_processor_integration.py::TestBBCProcessorInitialization::test_processor_has_rate_limiter PASSED [ 71%]
tests/integration/test_bbc_processor_integration.py::TestBBCRSSFeedParsing::test_scrape_rss_feeds_success FAILED [ 71%]
tests/integration/test_bbc_processor_integration.py::TestBBCRSSFeedParsing::test_scrape_rss_feeds_handles_errors FAILED [ 71%]
tests/integration/test_bbc_processor_integration.py::TestBBCArticleScraping::test_scrape_article_success PASSED [ 71%]
tests/integration/test_bbc_processor_integration.py::TestBBCArticleScraping::test_scrape_article_handles_404 PASSED [ 71%]
tests/integration/test_bbc_processor_integration.py::TestBBCArticleScraping::test_scrape_article_respects_rate_limiting PASSED [ 71%]
tests/integration/test_bbc_processor_integration.py::TestBBCHomepageScraping::test_scrape_homepage_success PASSED [ 72%]
tests/integration/test_bbc_processor_integration.py::TestBBCHomepageScraping::test_discover_topic_sections PASSED [ 72%]
tests/integration/test_bbc_processor_integration.py::TestBBCDeduplication::test_ledger_tracks_processed_urls PASSED [ 72%]
tests/integration/test_bbc_processor_integration.py::TestBBCDeduplication::test_dedup_engine_detects_duplicates PASSED [ 72%]
tests/integration/test_bbc_processor_integration.py::TestBBCDeduplication::test_compute_text_hash PASSED [ 72%]
tests/integration/test_bbc_processor_integration.py::TestBBCMetricsCollection::test_processor_initializes_metrics PASSED [ 72%]
tests/integration/test_bbc_processor_integration.py::TestBBCMetricsCollection::test_metrics_track_article_counts PASSED [ 72%]
tests/integration/test_bbc_processor_integration.py::TestBBCErrorHandling::test_handles_network_timeout PASSED [ 73%]
tests/integration/test_bbc_processor_integration.py::TestBBCErrorHandling::test_handles_connection_errors PASSED [ 73%]
tests/integration/test_bbc_processor_integration.py::TestBBCErrorHandling::test_handles_malformed_html PASSED [ 73%]
tests/integration/test_bbc_processor_integration.py::TestBBCTextCleaning::test_creates_html_cleaner PASSED [ 73%]
tests/integration/test_bbc_processor_integration.py::TestBBCTextCleaning::test_html_cleaner_removes_tags PASSED [ 73%]
tests/integration/test_bbc_processor_integration.py::TestBBCMetadataExtraction::test_get_source_type PASSED [ 73%]
tests/integration/test_bbc_processor_integration.py::TestBBCMetadataExtraction::test_get_license PASSED [ 74%]
tests/integration/test_bbc_processor_integration.py::TestBBCMetadataExtraction::test_get_language PASSED [ 74%]
tests/integration/test_bbc_processor_integration.py::TestBBCMetadataExtraction::test_get_domain PASSED [ 74%]
tests/integration/test_bbc_processor_integration.py::TestBBCMetadataExtraction::test_get_register PASSED [ 74%]
tests/integration/test_bbc_processor_integration.py::TestBBCMetadataExtraction::test_get_source_metadata PASSED [ 74%]
tests/integration/test_bbc_processor_integration.py::TestBBCHTTPSession::test_creates_session_with_retry_logic PASSED [ 74%]
tests/integration/test_bbc_processor_integration.py::TestBBCHTTPSession::test_session_has_custom_headers PASSED [ 74%]
tests/integration/test_metrics_anomalies.py::test_all_processing_metrics_validate_against_schema PASSED [ 75%]
tests/integration/test_metrics_anomalies.py::test_no_metrics_anomalies_in_latest_runs SKIPPEDmetrics recalculation) [ 75%]
tests/integration/test_metrics_anomalies.py::test_filter_breakdown_populated_when_filtering_occurred PASSED [ 75%]
tests/integration/test_metrics_anomalies.py::test_filter_breakdown_sum_consistency PASSED [ 75%]
tests/integration/test_metrics_anomalies.py::test_no_negative_counts_in_metrics PASSED [ 75%]
tests/integration/test_metrics_anomalies.py::test_quality_pass_rate_in_valid_range PASSED [ 75%]
tests/integration/test_metrics_anomalies.py::test_source_specific_filter_tracking[tiktok-somali] PASSED [ 76%]
tests/integration/test_metrics_anomalies.py::test_source_specific_filter_tracking[wikipedia-somali] PASSED [ 76%]
tests/integration/test_metrics_anomalies.py::test_source_specific_filter_tracking[huggingface-somali_c4-so] SKIPPED [ 76%]
tests/integration/test_metrics_anomalies.py::test_source_specific_filter_tracking[sprakbanken-somali] PASSED [ 76%]
tests/integration/test_metrics_anomalies.py::test_source_specific_filter_tracking[bbc-somali] SKIPPED [ 76%]
tests/performance/test_performance_improvements.py::TestAsyncHTTPPerformance::test_async_vs_sync_fetch_simulation PASSED [ 76%]
tests/performance/test_performance_improvements.py::TestAsyncHTTPPerformance::test_async_http_available PASSED [ 76%]
tests/performance/test_performance_improvements.py::TestShardedLSHPerformance::test_sharded_vs_monolithic_lsh_insert FAILED [ 77%]
tests/performance/test_performance_improvements.py::TestShardedLSHPerformance::test_sharded_lsh_query_performance FAILED [ 77%]
tests/performance/test_performance_improvements.py::TestShardedLSHPerformance::test_sharded_lsh_save_load PASSED [ 77%]
tests/performance/test_performance_improvements.py::TestFileIOPerformance::test_buffered_write_performance PASSED [ 77%]
tests/performance/test_performance_improvements.py::TestFileIOPerformance::test_buffered_read_performance FAILED [ 77%]
tests/performance/test_performance_improvements.py::TestFileIOPerformance::test_data_manager_optimized_methods PASSED [ 77%]
tests/performance/test_performance_improvements.py::TestFileIOPerformance::test_checksum_optimized PASSED [ 78%]
tests/performance/test_performance_improvements.py::TestIntegratedPerformance::test_minhash_deduplicator_with_sharding PASSED [ 78%]
tests/performance/test_performance_improvements.py::TestIntegratedPerformance::test_performance_summary PASSED [ 78%]
tests/pipeline/test_filter_engine.py::TestFilterEngine::test_initialization PASSED [ 78%]
tests/pipeline/test_filter_engine.py::TestFilterEngine::test_register_filter PASSED [ 78%]
tests/pipeline/test_filter_engine.py::TestFilterEngine::test_apply_filters_all_pass PASSED [ 78%]
tests/pipeline/test_filter_engine.py::TestFilterEngine::test_apply_filters_one_fails PASSED [ 79%]
tests/pipeline/test_filter_engine.py::TestFilterEngine::test_apply_filters_with_kwargs PASSED [ 79%]
tests/pipeline/test_filter_engine.py::TestFilterEngine::test_filter_stats FAILED [ 79%]
tests/pipeline/test_filter_engine.py::TestFilterEngine::test_get_human_readable_stats PASSED [ 79%]
tests/pipeline/test_filter_engine.py::TestFilterEngine::test_reset_stats PASSED [ 79%]
tests/pipeline/test_filter_engine.py::TestFilterEngine::test_filter_exception_handling PASSED [ 79%]
tests/preprocessing/test_record_builder.py::TestRecordBuilder::test_initialization PASSED [ 79%]
tests/preprocessing/test_record_builder.py::TestRecordBuilder::test_build_silver_record PASSED [ 80%]
tests/preprocessing/test_record_builder.py::TestRecordBuilder::test_metadata_merging PASSED [ 80%]
tests/preprocessing/test_record_builder.py::TestRecordBuilder::test_source_id_extraction PASSED [ 80%]
tests/preprocessing/test_record_builder.py::TestRecordBuilder::test_add_metadata PASSED [ 80%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_emoji_only_filter_tracked PASSED [ 80%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_short_text_filter_tracked PASSED [ 80%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_short_text_with_symbols_filter_tracked PASSED [ 81%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_valid_comment_not_filtered PASSED [ 81%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_valid_comment_three_char_minimum PASSED [ 81%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_somali_text_valid_comments PASSED [ 81%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_comment_metadata_preservation PASSED [ 81%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_empty_text_handling PASSED [ 81%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_mixed_emoji_and_text_passes_filter PASSED [ 81%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_comment_url_construction PASSED [ 82%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_missing_optional_fields_handling PASSED [ 82%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_comment_type_consistency PASSED [ 82%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokFilterInstrumentation::test_unicode_and_extended_characters PASSED [ 82%]
tests/preprocessing/test_tiktok_filters.py::TestTikTokProcessorIntegration::test_filter_consistency_across_multiple_comments PASSED [ 82%]
tests/regression/test_filter_telemetry.py::test_filter_breakdown_present_when_filtering_occurred PASSED [ 82%]
tests/regression/test_filter_telemetry.py::test_filter_breakdown_totals_match_records_filtered SKIPPEDi
  Filter sum: 700
  Records filtered:
69
  Difference: 631 (914.5%)
  Tolerance: 1

 This may indicate:
   -
Multiple filters triggering per record (expected)
   - Missing
instrumentation (if sum < records_filtered)
   - Double-counting (if sum
> records_filtered)


(Multiple filters per record is expected
behavior))                                                               [ 83%]
tests/regression/test_filter_telemetry.py::test_all_filter_keys_in_catalog PASSED [ 83%]
tests/regression/test_filter_telemetry.py::test_fixtures_available PASSED [ 83%]
tests/regression/test_filter_telemetry.py::test_bad_fixture_triggers_regression_detection PASSED [ 83%]
tests/schema/test_schema_registry.py::TestSchemaRegistry::test_get_schema_valid PASSED [ 83%]
tests/schema/test_schema_registry.py::TestSchemaRegistry::test_get_schema_invalid PASSED [ 83%]
tests/schema/test_schema_registry.py::TestSchemaRegistry::test_get_current_schema PASSED [ 83%]
tests/schema/test_schema_registry.py::TestSchemaRegistry::test_schema_registry_structure PASSED [ 84%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_valid_record PASSED [ 84%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_empty_text_rejected PASSED [ 84%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_whitespace_only_text_rejected PASSED [ 84%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_invalid_source_rejected PASSED [ 84%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_valid_sources_accepted PASSED [ 84%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_invalid_source_type_rejected PASSED [ 85%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_valid_source_types_accepted PASSED [ 85%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_invalid_register_rejected PASSED [ 85%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_valid_registers_accepted PASSED [ 85%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_invalid_language_rejected PASSED [ 85%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_valid_languages_accepted PASSED [ 85%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_negative_tokens_rejected PASSED [ 86%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_excessive_tokens_rejected PASSED [ 86%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_valid_token_range_accepted PASSED [ 86%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_invalid_date_format_rejected PASSED [ 86%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_valid_date_formats_accepted PASSED [ 86%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_optional_fields_can_be_none PASSED [ 86%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_extra_fields_rejected PASSED [ 86%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_missing_required_field_rejected PASSED [ 87%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_schema_version_defaults_to_1_0 PASSED [ 87%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_language_defaults_to_so PASSED [ 87%]
tests/schema/test_schema_registry.py::TestSchemaV1_0Validation::test_source_metadata_defaults_to_empty_json PASSED [ 87%]
tests/schema/test_validation_service.py::TestValidationService::test_initialization PASSED [ 87%]
tests/schema/test_validation_service.py::TestValidationService::test_initialization_with_version PASSED [ 87%]
tests/schema/test_validation_service.py::TestValidationService::test_validate_valid_record PASSED [ 88%]
tests/schema/test_validation_service.py::TestValidationService::test_validate_invalid_record PASSED [ 88%]
tests/schema/test_validation_service.py::TestValidationService::test_get_validation_errors PASSED [ 88%]
tests/schema/test_validation_service.py::TestValidationService::test_get_failure_count PASSED [ 88%]
tests/schema/test_validation_service.py::TestValidationService::test_reset_failures PASSED [ 88%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_record_valid PASSED [ 88%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_record_invalid_empty_text PASSED [ 88%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_record_invalid_source PASSED [ 89%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_record_missing_field PASSED [ 89%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_record_extra_field PASSED [ 89%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_record_with_version PASSED [ 89%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_dataframe_all_valid PASSED [ 89%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_dataframe_some_invalid PASSED [ 89%]
tests/schema/test_validator.py::TestSchemaValidator::test_add_schema_version PASSED [ 90%]
tests/schema/test_validator.py::TestSchemaValidator::test_add_schema_version_custom PASSED [ 90%]
tests/schema/test_validator.py::TestSchemaValidator::test_get_validation_report PASSED [ 90%]
tests/schema/test_validator.py::TestSchemaValidator::test_get_validation_report_without_validation PASSED [ 90%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_dataframe_empty PASSED [ 90%]
tests/schema/test_validator.py::TestSchemaValidator::test_validate_record_returns_detailed_errors PASSED [ 90%]
tests/security/test_security_fixes.py::TestSQLInjectionPrevention::test_get_statistics_sql_injection PASSED [ 90%]
tests/security/test_security_fixes.py::TestSQLInjectionPrevention::test_get_statistics_drop_table_injection PASSED [ 91%]
tests/security/test_security_fixes.py::TestSQLInjectionPrevention::test_get_statistics_union_injection PASSED [ 91%]
tests/security/test_security_fixes.py::TestPathTraversalPrevention::test_sanitize_source_name_basic PASSED [ 91%]
tests/security/test_security_fixes.py::TestPathTraversalPrevention::test_sanitize_source_name_null_bytes PASSED [ 91%]
tests/security/test_security_fixes.py::TestPathTraversalPrevention::test_sanitize_source_name_mixed_case PASSED [ 91%]
tests/security/test_security_fixes.py::TestPathTraversalPrevention::test_sanitize_source_name_unknown_source PASSED [ 91%]
tests/security/test_security_fixes.py::TestPathTraversalPrevention::test_base_pipeline_sanitizes_source PASSED [ 92%]
tests/security/test_security_fixes.py::TestSecretsMasking::test_mask_secret_basic PASSED [ 92%]
tests/security/test_security_fixes.py::TestSecretsMasking::test_mask_secret_custom_visible_chars PASSED [ 92%]
tests/security/test_security_fixes.py::TestSecretsMasking::test_mask_secret_edge_cases PASSED [ 92%]
tests/security/test_security_fixes.py::TestFilenameeSanitization::test_sanitize_filename_basic PASSED [ 92%]
tests/security/test_security_fixes.py::TestFilenameeSanitization::test_sanitize_filename_path_traversal PASSED [ 92%]
tests/security/test_security_fixes.py::TestFilenameeSanitization::test_sanitize_filename_null_bytes PASSED [ 93%]
tests/security/test_security_fixes.py::TestFilenameeSanitization::test_sanitize_filename_empty_result PASSED [ 93%]
tests/security/test_security_fixes.py::TestURLSanitization::test_is_safe_url_valid PASSED [ 93%]
tests/security/test_security_fixes.py::TestURLSanitization::test_is_safe_url_localhost PASSED [ 93%]
tests/security/test_security_fixes.py::TestURLSanitization::test_is_safe_url_file_protocol PASSED [ 93%]
tests/security/test_security_fixes.py::TestURLSanitization::test_is_safe_url_private_ips PASSED [ 93%]
tests/security/test_security_fixes.py::TestXSSPrevention::test_dashboard_has_security_utilities PASSED [ 93%]
tests/security/test_security_fixes.py::TestSecurityIntegration::test_sql_injection_in_real_scenario PASSED [ 94%]
tests/security/test_security_fixes.py::TestSecurityIntegration::test_path_traversal_in_pipeline_init PASSED [ 94%]
tests/unit/test_dashboard_data_integrity.py::test_sankey_flow_has_stage_counts PASSED [ 94%]
tests/unit/test_dashboard_data_integrity.py::test_text_distributions_are_non_empty PASSED [ 94%]
tests/unit/test_dashboard_data_integrity.py::test_dashboard_metadata_exposes_visualisation_flags SKIPPEDipeline run) [ 94%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestSchemaValidation::test_valid_v3_web_scraping_schema PASSED [ 94%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestSchemaValidation::test_valid_v3_file_processing_schema PASSED [ 95%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestSchemaValidation::test_valid_v3_stream_processing_schema PASSED [ 95%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestSchemaValidation::test_backward_compatibility_v2_schema PASSED [ 95%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestSchemaValidation::test_missing_required_fields_handled_gracefully PASSED [ 95%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestSchemaValidation::test_malformed_json_raises_error PASSED [ 95%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestSchemaValidation::test_unicode_in_source_names PASSED [ 95%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestNullAndMissingValues::test_null_quality_metrics_defaults_to_zero PASSED [ 95%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestNullAndMissingValues::test_missing_statistics_field PASSED [ 96%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestNullAndMissingValues::test_null_performance_metrics PASSED [ 96%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestNullAndMissingValues::test_missing_text_length_stats PASSED [ 96%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestEdgeCases::test_zero_records_written PASSED [ 96%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestEdgeCases::test_very_large_numbers PASSED [ 96%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestEdgeCases::test_negative_values_in_metrics PASSED [ 96%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestEdgeCases::test_duplicate_run_ids PASSED [ 97%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestEdgeCases::test_empty_string_values PASSED [ 97%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestMetricsDirectoryProcessing::test_load_all_metrics_from_directory PASSED [ 97%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestMetricsDirectoryProcessing::test_empty_directory_returns_no_metrics PASSED [ 97%]
tests/unit/dashboard/test_metrics_schema_validation.py::TestMetricsDirectoryProcessing::test_mixed_file_types_only_loads_processing PASSED [ 97%]
tests/utils/test_http.py::TestHTTPSessionFactory::test_create_session_default_params PASSED [ 97%]
tests/utils/test_http.py::TestHTTPSessionFactory::test_create_session_custom_retries PASSED [ 97%]
tests/utils/test_http.py::TestHTTPSessionFactory::test_create_session_custom_status_forcelist PASSED [ 98%]
tests/utils/test_http.py::TestHTTPSessionFactory::test_create_session_custom_user_agent PASSED [ 98%]
tests/utils/test_http.py::TestHTTPSessionFactory::test_create_session_custom_allowed_methods PASSED [ 98%]
tests/utils/test_http.py::TestHTTPSessionFactory::test_create_session_backoff_factor PASSED [ 98%]
tests/utils/test_http.py::TestHTTPSessionFactory::test_session_has_both_http_and_https_adapters PASSED [ 98%]
tests/utils/test_http.py::TestRateLimiter::test_rate_limiter_initialization PASSED [ 98%]
tests/utils/test_http.py::TestRateLimiter::test_rate_limiter_default_rate PASSED [ 99%]
tests/utils/test_http.py::TestRateLimiter::test_rate_limiter_wait_enforces_delay PASSED [ 99%]
tests/utils/test_http.py::TestRateLimiter::test_rate_limiter_no_wait_on_first_call PASSED [ 99%]
tests/utils/test_http.py::TestRateLimiter::test_rate_limiter_multiple_calls PASSED [ 99%]
tests/utils/test_http.py::TestRateLimiter::test_rate_limiter_high_rate PASSED [ 99%]
tests/utils/test_http.py::TestHTTPSessionIntegration::test_session_can_make_request PASSED [ 99%]
tests/utils/test_http.py::TestHTTPSessionIntegration::test_session_retry_on_500_error PASSED [100%]<unknown>:27: SyntaxWarning: invalid escape sequence '\)'
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/utils/security.py:27: SyntaxWarning: invalid escape sequence '\)'
  """
<unknown>:27: SyntaxWarning: invalid escape sequence '\)'
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/utils/security.py:27: SyntaxWarning: invalid escape sequence '\)'
  """
<unknown>:27: SyntaxWarning: invalid escape sequence '\)'
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/utils/security.py:27: SyntaxWarning: invalid escape sequence '\)'
  """
<unknown>:27: SyntaxWarning: invalid escape sequence '\)'
<unknown>:27: SyntaxWarning: invalid escape sequence '\)'


==================================== ERRORS ====================================
_ ERROR at setup of TestSprakbankenIncrementalProcessing.test_extract_corpus_id_from_korp_url _
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:46: in sanitize_and_validate_source
    return sanitize_source_name(source)
src/somali_dialect_classifier/utils/security.py:76: in sanitize_source_name
    raise ValueError(
E   ValueError: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)

During handling of the above exception, another exception occurred:
tests/test_incremental_processing.py:51: in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py:213: in __init__
    super().__init__(
src/somali_dialect_classifier/preprocessing/base_pipeline.py:48: in __init__
    self.source = PipelineSetup.sanitize_and_validate_source(source)
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:48: in sanitize_and_validate_source
    raise ValueError(f"Invalid source name: {e}")
E   ValueError: Invalid source name: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)
---------------------------- Captured stderr setup -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log setup ------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
_ ERROR at setup of TestSprakbankenIncrementalProcessing.test_extract_corpus_id_from_download_url _
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:46: in sanitize_and_validate_source
    return sanitize_source_name(source)
src/somali_dialect_classifier/utils/security.py:76: in sanitize_source_name
    raise ValueError(
E   ValueError: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)

During handling of the above exception, another exception occurred:
tests/test_incremental_processing.py:51: in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py:213: in __init__
    super().__init__(
src/somali_dialect_classifier/preprocessing/base_pipeline.py:48: in __init__
    self.source = PipelineSetup.sanitize_and_validate_source(source)
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:48: in sanitize_and_validate_source
    raise ValueError(f"Invalid source name: {e}")
E   ValueError: Invalid source name: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)
---------------------------- Captured stderr setup -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log setup ------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
_ ERROR at setup of TestSprakbankenIncrementalProcessing.test_first_run_processes_all_corpora _
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:46: in sanitize_and_validate_source
    return sanitize_source_name(source)
src/somali_dialect_classifier/utils/security.py:76: in sanitize_source_name
    raise ValueError(
E   ValueError: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)

During handling of the above exception, another exception occurred:
tests/test_incremental_processing.py:51: in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py:213: in __init__
    super().__init__(
src/somali_dialect_classifier/preprocessing/base_pipeline.py:48: in __init__
    self.source = PipelineSetup.sanitize_and_validate_source(source)
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:48: in sanitize_and_validate_source
    raise ValueError(f"Invalid source name: {e}")
E   ValueError: Invalid source name: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)
---------------------------- Captured stderr setup -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log setup ------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
_ ERROR at setup of TestSprakbankenIncrementalProcessing.test_subsequent_run_filters_processed_corpora _
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:46: in sanitize_and_validate_source
    return sanitize_source_name(source)
src/somali_dialect_classifier/utils/security.py:76: in sanitize_source_name
    raise ValueError(
E   ValueError: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)

During handling of the above exception, another exception occurred:
tests/test_incremental_processing.py:51: in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py:213: in __init__
    super().__init__(
src/somali_dialect_classifier/preprocessing/base_pipeline.py:48: in __init__
    self.source = PipelineSetup.sanitize_and_validate_source(source)
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:48: in sanitize_and_validate_source
    raise ValueError(f"Invalid source name: {e}")
E   ValueError: Invalid source name: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)
---------------------------- Captured stderr setup -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log setup ------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
_ ERROR at setup of TestSprakbankenIncrementalProcessing.test_all_corpora_processed_skips_all _
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:46: in sanitize_and_validate_source
    return sanitize_source_name(source)
src/somali_dialect_classifier/utils/security.py:76: in sanitize_source_name
    raise ValueError(
E   ValueError: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)

During handling of the above exception, another exception occurred:
tests/test_incremental_processing.py:51: in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py:213: in __init__
    super().__init__(
src/somali_dialect_classifier/preprocessing/base_pipeline.py:48: in __init__
    self.source = PipelineSetup.sanitize_and_validate_source(source)
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:48: in sanitize_and_validate_source
    raise ValueError(f"Invalid source name: {e}")
E   ValueError: Invalid source name: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)
---------------------------- Captured stderr setup -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log setup ------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
_ ERROR at setup of TestIncrementalProcessingMetrics.test_sprakbanken_incremental_metrics _
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:46: in sanitize_and_validate_source
    return sanitize_source_name(source)
src/somali_dialect_classifier/utils/security.py:76: in sanitize_source_name
    raise ValueError(
E   ValueError: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)

During handling of the above exception, another exception occurred:
tests/test_incremental_processing.py:51: in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py:213: in __init__
    super().__init__(
src/somali_dialect_classifier/preprocessing/base_pipeline.py:48: in __init__
    self.source = PipelineSetup.sanitize_and_validate_source(source)
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:48: in sanitize_and_validate_source
    raise ValueError(f"Invalid source name: {e}")
E   ValueError: Invalid source name: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)
---------------------------- Captured stderr setup -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log setup ------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
__ ERROR at setup of TestFailSafeBehavior.test_query_error_returns_empty_set ___
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:46: in sanitize_and_validate_source
    return sanitize_source_name(source)
src/somali_dialect_classifier/utils/security.py:76: in sanitize_source_name
    raise ValueError(
E   ValueError: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)

During handling of the above exception, another exception occurred:
tests/test_incremental_processing.py:51: in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py:213: in __init__
    super().__init__(
src/somali_dialect_classifier/preprocessing/base_pipeline.py:48: in __init__
    self.source = PipelineSetup.sanitize_and_validate_source(source)
src/somali_dialect_classifier/preprocessing/pipeline_setup.py:48: in sanitize_and_validate_source
    raise ValueError(f"Invalid source name: {e}")
E   ValueError: Invalid source name: Invalid source: sprakbanken-somali. Allowed sources: bbc, bbc-somali, huggingface, sprakbanken, tiktok, wikipedia, wikipedia-somali (HuggingFace sources with dataset suffixes are also allowed)
---------------------------- Captured stderr setup -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 127, in runtestprotocol
    rep = call_and_report(item, "setup", log)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 157, in pytest_runtest_setup
    item.session._setupstate.setup(item)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 494, in setup
    col.setup()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1795, in setup
    self._request._fillfixtures()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 566, in _fillfixtures
    item.funcargs[argname] = self.getfixturevalue(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 585, in getfixturevalue
    fixturedef = self._get_active_fixturedef(argname)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 607, in _get_active_fixturedef
    self._compute_fixture_value(fixturedef)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 693, in _compute_fixture_value
    fixturedef.execute(request=subrequest)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in execute
    result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 1123, in pytest_fixture_setup
    result = call_fixture_func(fixturefunc, request, kwargs)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/fixtures.py", line 902, in call_fixture_func
    fixture_result = fixturefunc(**kwargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_incremental_processing.py", line 51, in mock_sprakbanken_processor
    processor = SprakbankenSomaliProcessor(corpus_id="somali-cilmi", force=False)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py", line 208, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log setup ------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
_________ ERROR at setup of TestBackendAPIs.test_discover_url_postgres _________
tests/database/test_backend_compatibility.py:35: in postgres_ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_________ ERROR at setup of TestBackendAPIs.test_mark_fetched_postgres _________
tests/database/test_backend_compatibility.py:35: in postgres_ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
________ ERROR at setup of TestBackendAPIs.test_mark_processed_postgres ________
tests/database/test_backend_compatibility.py:35: in postgres_ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_________ ERROR at setup of TestBackendAPIs.test_is_duplicate_postgres _________
tests/database/test_backend_compatibility.py:35: in postgres_ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_ ERROR at setup of TestBackendBehaviorParity.test_statistics_parity_postgres __
tests/database/test_backend_compatibility.py:35: in postgres_ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
__ ERROR at setup of TestBackendBehaviorParity.test_get_pending_urls_postgres __
tests/database/test_backend_compatibility.py:35: in postgres_ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_______ ERROR at setup of TestConcurrentWrites.test_5_concurrent_sources _______
tests/database/test_load_postgres.py:27: in ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
______ ERROR at setup of TestConcurrentWrites.test_10x_concurrent_writes _______
tests/database/test_load_postgres.py:27: in ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
___ ERROR at setup of TestQueryPerformance.test_concurrent_reads_and_writes ____
tests/database/test_load_postgres.py:27: in ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_________ ERROR at setup of TestQueryPerformance.test_bulk_operations __________
tests/database/test_load_postgres.py:27: in ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
___ ERROR at setup of TestConnectionPooling.test_connection_pool_exhaustion ____
tests/database/test_load_postgres.py:27: in ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
______ ERROR at setup of TestStressScenarios.test_rapid_state_transitions ______
tests/database/test_load_postgres.py:27: in ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
__ ERROR at setup of TestStressScenarios.test_concurrent_duplicate_detection ___
tests/database/test_load_postgres.py:27: in ledger
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
___ ERROR at setup of TestPostgresLedgerBasics.test_connection_pool_creation ___
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
____ ERROR at setup of TestPostgresLedgerBasics.test_schema_initialization _____
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
______ ERROR at setup of TestPostgresLedgerBasics.test_upsert_url_insert _______
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
______ ERROR at setup of TestPostgresLedgerBasics.test_upsert_url_update _______
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
______ ERROR at setup of TestPostgresLedgerBasics.test_get_urls_by_state _______
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
________ ERROR at setup of TestPostgresLedgerBasics.test_mark_url_state ________
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
___ ERROR at setup of TestPostgresLedgerBasics.test_check_duplicate_by_hash ____
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_ ERROR at setup of TestPostgresConcurrency.test_concurrent_writes_10_threads __
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_ ERROR at setup of TestPostgresConcurrency.test_concurrent_writes_50_threads __
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_________ ERROR at setup of TestPostgresPerformance.test_query_latency _________
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
____ ERROR at setup of TestPostgresPerformance.test_bulk_insert_performance ____
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_________ ERROR at setup of TestPostgresStatistics.test_get_statistics _________
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_________ ERROR at setup of TestPostgresRSSFeed.test_record_rss_fetch __________
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_________ ERROR at setup of TestPostgresRSSFeed.test_should_fetch_rss __________
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
________ ERROR at setup of TestPostgresCleanup.test_cleanup_old_entries ________
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_______ ERROR at setup of TestPostgresCleanup.test_connection_pool_close _______
tests/database/test_postgres_ledger.py:35: in postgres_ledger
    ledger = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
=================================== FAILURES ===================================
________________ TestBBCIntegration.test_creates_silver_dataset ________________
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_bbc_integration.py:147: in test_creates_silver_dataset
    assert all(df["source"] == "BBC-Somali")
E   AssertionError: assert False
E    +  where False = all(0    bbc-somali\n1    bbc-somali\n2    bbc-somali\nName: source, dtype: object == 'BBC-Somali')
----------------------------- Captured stderr call -----------------------------
{"timestamp": "2025-11-13T16:24:43.453435+00:00", "level": "INFO", "logger": "bbc-somali", "message": "\n============================================================"}
{"timestamp": "2025-11-13T16:24:43.453540+00:00", "level": "INFO", "logger": "bbc-somali", "message": "PHASE 3: Text Processing & Silver Dataset Creation"}
{"timestamp": "2025-11-13T16:24:43.453616+00:00", "level": "INFO", "logger": "bbc-somali", "message": "============================================================"}
{"timestamp": "2025-11-13T16:24:43.454414+00:00", "level": "INFO", "logger": "bbc-somali", "message": "============================================================"}
{"timestamp": "2025-11-13T16:24:43.454490+00:00", "level": "INFO", "logger": "bbc-somali", "message": "Processing complete: 3 records"}
{"timestamp": "2025-11-13T16:24:43.454561+00:00", "level": "INFO", "logger": "bbc-somali", "message": "Filtered: 1 records"}
{"timestamp": "2025-11-13T16:24:43.454634+00:00", "level": "INFO", "logger": "bbc-somali", "message": "============================================================"}
------------------------------ Captured log call -------------------------------
INFO     bbc-somali:base_pipeline.py:135 
============================================================
INFO     bbc-somali:base_pipeline.py:136 PHASE 3: Text Processing & Silver Dataset Creation
INFO     bbc-somali:base_pipeline.py:137 ============================================================
INFO     bbc-somali:base_pipeline.py:206 ============================================================
INFO     bbc-somali:base_pipeline.py:207 Processing complete: 3 records
INFO     bbc-somali:base_pipeline.py:210 Filtered: 1 records
INFO     bbc-somali:base_pipeline.py:219 ============================================================
____________________ TestWikipediaCLI.test_cli_help_output _____________________
tests/test_cli_e2e.py:67: in test_cli_help_output
    download_wikisom.main()
src/somali_dialect_classifier/cli/download_wikisom.py:64: in main
    dump_file = processor.download()
src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py:228: in download
    self._export_stage_metrics("discovery")
src/somali_dialect_classifier/preprocessing/base_pipeline.py:314: in _export_stage_metrics
    metrics_path = config.data.metrics_dir / f"{timestamp}_{self.source}_{self.run_id}_{stage}.json"
/opt/anaconda3/lib/python3.12/site-packages/pydantic/main.py:1026: in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E   AttributeError: 'DataConfig' object has no attribute 'metrics_dir'
----------------------------- Captured stderr call -----------------------------
2025-11-13 19:24:45,481 - somali_dialect_classifier.preprocessing.dedup - INFO - Initialized ShardedLSH with 10 shards
2025-11-13 19:24:45,483 - somali_dialect_classifier.preprocessing.dedup - INFO - Using ShardedLSH with 10 shards for 2-3x performance
{"timestamp": "2025-11-13T16:24:45.484125+00:00", "level": "INFO", "logger": "wikipedia-somali", "message": "Downloading from: https://dumps.wikimedia.org/sowiki/latest/sowiki-latest-pages-articles.xml.bz2", "run_id": "20251113_162445_wikipedia-somali_bd699192", "source": "wikipedia-somali", "phase": "download"}
2025-11-13 19:24:45,484 - wikipedia-somali - INFO - Downloading from: https://dumps.wikimedia.org/sowiki/latest/sowiki-latest-pages-articles.xml.bz2
Downloading:   0%|          | 0.00/14.8M [00:00<?, ?B/s]Downloading:   0%|          | 32.8k/14.8M [00:00<01:46, 138kB/s]Downloading:   0%|          | 65.5k/14.8M [00:00<01:28, 167kB/s]Downloading:   1%|          | 98.3k/14.8M [00:00<01:13, 200kB/s]Downloading:   1%|          | 147k/14.8M [00:00<00:54, 271kB/s] Downloading:   1%|         | 197k/14.8M [00:00<00:44, 330kB/s]Downloading:   2%|         | 262k/14.8M [00:00<00:35, 414kB/s]Downloading:   2%|         | 360k/14.8M [00:00<00:25, 561kB/s]Downloading:   3%|         | 492k/14.8M [00:01<00:18, 756kB/s]Downloading:   4%|         | 655k/14.8M [00:01<00:14, 994kB/s]Downloading:   6%|         | 868k/14.8M [00:01<00:10, 1.30MB/s]Downloading:   8%|         | 1.13M/14.8M [00:01<00:08, 1.65MB/s]Downloading:   9%|         | 1.38M/14.8M [00:01<00:07, 1.82MB/s]Downloading:  11%|         | 1.62M/14.8M [00:01<00:06, 2.00MB/s]Downloading:  12%|        | 1.83M/14.8M [00:02<00:14, 907kB/s] Downloading:  15%|        | 2.21M/14.8M [00:02<00:09, 1.36MB/s]Downloading:  17%|        | 2.57M/14.8M [00:02<00:07, 1.74MB/s]Downloading:  20%|        | 2.98M/14.8M [00:02<00:09, 1.20MB/s]Downloading:  24%|       | 3.60M/14.8M [00:02<00:06, 1.85MB/s]Downloading:  26%|       | 3.92M/14.8M [00:03<00:08, 1.34MB/s]Downloading:  31%|       | 4.60M/14.8M [00:03<00:04, 2.05MB/s]Downloading:  35%|      | 5.13M/14.8M [00:03<00:03, 2.55MB/s]Downloading:  39%|      | 5.80M/14.8M [00:03<00:02, 3.28MB/s]Downloading:  42%|     | 6.28M/14.8M [00:04<00:05, 1.70MB/s]Downloading:  45%|     | 6.64M/14.8M [00:05<00:08, 977kB/s] Downloading:  58%|    | 8.60M/14.8M [00:05<00:02, 2.47MB/s]Downloading:  63%|   | 9.35M/14.8M [00:05<00:02, 2.44MB/s]Downloading:  67%|   | 9.95M/14.8M [00:06<00:03, 1.59MB/s]Downloading:  71%|   | 10.5M/14.8M [00:06<00:02, 1.64MB/s]Downloading:  80%|  | 11.9M/14.8M [00:07<00:01, 1.96MB/s]Downloading:  93%|| 13.8M/14.8M [00:07<00:00, 3.41MB/s]Downloading:  99%|| 14.6M/14.8M [00:07<00:00, 2.87MB/s]Downloading: 100%|| 14.8M/14.8M [00:07<00:00, 1.88MB/s]
{"timestamp": "2025-11-13T16:24:54.763824+00:00", "level": "INFO", "logger": "wikipedia-somali", "message": "Download completed: data/raw/source=wikipedia-somali/date_accessed=2025-11-13/sowiki-latest-pages-articles.xml.bz2", "run_id": "20251113_162445_wikipedia-somali_bd699192", "source": "wikipedia-somali", "phase": "download"}
2025-11-13 19:24:54,763 - wikipedia-somali - INFO - Download completed: data/raw/source=wikipedia-somali/date_accessed=2025-11-13/sowiki-latest-pages-articles.xml.bz2
2025-11-13 19:24:54,764 - root - ERROR - Pipeline failed: 'DataConfig' object has no attribute 'metrics_dir'
____ TestCLIDataDirectories.test_wikipedia_creates_partitioned_directories _____
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py:157: in test_wikipedia_creates_partitioned_directories
    assert "source=Wikipedia-Somali" in str(processor.raw_dir)
E   AssertionError: assert 'source=Wikipedia-Somali' in 'data/raw/source=wikipedia-somali/date_accessed=2025-11-13'
E    +  where 'data/raw/source=wikipedia-somali/date_accessed=2025-11-13' = str(PosixPath('data/raw/source=wikipedia-somali/date_accessed=2025-11-13'))
E    +    where PosixPath('data/raw/source=wikipedia-somali/date_accessed=2025-11-13') = <somali_dialect_classifier.preprocessing.wikipedia_somali_processor.WikipediaSomaliProcessor object at 0x30ac7b800>.raw_dir
----------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 154, in test_wikipedia_creates_partitioned_directories
    processor = WikipediaSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 50, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 154, in test_wikipedia_creates_partitioned_directories
    processor = WikipediaSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 50, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log call -------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
_______ TestCLIDataDirectories.test_bbc_creates_partitioned_directories ________
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py:167: in test_bbc_creates_partitioned_directories
    assert "source=BBC-Somali" in str(processor.raw_dir)
E   AssertionError: assert 'source=BBC-Somali' in 'data/raw/source=bbc-somali/date_accessed=2025-11-13'
E    +  where 'data/raw/source=bbc-somali/date_accessed=2025-11-13' = str(PosixPath('data/raw/source=bbc-somali/date_accessed=2025-11-13'))
E    +    where PosixPath('data/raw/source=bbc-somali/date_accessed=2025-11-13') = <somali_dialect_classifier.preprocessing.bbc_somali_processor.BBCSomaliProcessor object at 0x30ac7a000>.raw_dir
----------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 164, in test_bbc_creates_partitioned_directories
    processor = BBCSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 72, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 164, in test_bbc_creates_partitioned_directories
    processor = BBCSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 72, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log call -------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
_________ TestCLIOutput.test_processors_have_consistent_logging_format _________
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py:219: in test_processors_have_consistent_logging_format
    assert (
E   AssertionError: assert ('base_pipeline' in 'wikipedia-somali' or 'somali_dialect_classifier' in 'wikipedia-somali' or 'Wikipedia' in 'wikipedia-somali')
E    +  where 'wikipedia-somali' = <Logger wikipedia-somali (INFO)>.name
E    +    where <Logger wikipedia-somali (INFO)> = <somali_dialect_classifier.preprocessing.wikipedia_somali_processor.WikipediaSomaliProcessor object at 0x30c197200>.logger
E    +  and   'wikipedia-somali' = <Logger wikipedia-somali (INFO)>.name
E    +    where <Logger wikipedia-somali (INFO)> = <somali_dialect_classifier.preprocessing.wikipedia_somali_processor.WikipediaSomaliProcessor object at 0x30c197200>.logger
E    +  and   'wikipedia-somali' = <Logger wikipedia-somali (INFO)>.name
E    +    where <Logger wikipedia-somali (INFO)> = <somali_dialect_classifier.preprocessing.wikipedia_somali_processor.WikipediaSomaliProcessor object at 0x30c197200>.logger
----------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 213, in test_processors_have_consistent_logging_format
    wiki_processor = WikipediaSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 50, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 213, in test_processors_have_consistent_logging_format
    wiki_processor = WikipediaSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 50, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 214, in test_processors_have_consistent_logging_format
    bbc_processor = BBCSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 72, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 214, in test_processors_have_consistent_logging_format
    bbc_processor = BBCSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 72, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
------------------------------ Captured log call -------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
_______ TestCLIIntegration.test_wikipedia_cli_full_pipeline_with_fixture _______
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py:256: in test_wikipedia_cli_full_pipeline_with_fixture
    result = processor.run()
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/base_pipeline.py:273: in run
    self.extract()
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py:306: in extract
    self.metrics.add_custom_metric("incremental_filtering", filter_stats)
E   AttributeError: 'MetricsCollector' object has no attribute 'add_custom_metric'

During handling of the above exception, another exception occurred:
/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py:267: in test_wikipedia_cli_full_pipeline_with_fixture
    pytest.fail(f"Wikipedia pipeline failed: {e}")
E   Failed: Wikipedia pipeline failed: 'MetricsCollector' object has no attribute 'add_custom_metric'
----------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 242, in test_wikipedia_cli_full_pipeline_with_fixture
    processor = WikipediaSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 50, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 242, in test_wikipedia_cli_full_pipeline_with_fixture
    processor = WikipediaSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 50, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
{"timestamp": "2025-11-13T16:24:57.058474+00:00", "level": "INFO", "logger": "wikipedia-somali", "message": "Dump already exists: data/raw/source=wikipedia-somali/date_accessed=2025-11-13/sowiki-latest-pages-articles.xml.bz2", "run_id": "20251113_162457_wikipedia-somali_606c2c9a", "source": "wikipedia-somali", "phase": "download"}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 256, in test_wikipedia_cli_full_pipeline_with_fixture
    result = processor.run()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/base_pipeline.py", line 272, in run
    self.download()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 176, in download
    self.logger.info(f"Dump already exists: {self.dump_file}")
Message: 'Dump already exists: data/raw/source=wikipedia-somali/date_accessed=2025-11-13/sowiki-latest-pages-articles.xml.bz2'
Arguments: ()
{"timestamp": "2025-11-13T16:24:57.059105+00:00", "level": "INFO", "logger": "wikipedia-somali", "message": "Extracting text from XML dump...", "run_id": "20251113_162457_wikipedia-somali_606c2c9a", "source": "wikipedia-somali", "phase": "extract"}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 256, in test_wikipedia_cli_full_pipeline_with_fixture
    result = processor.run()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/base_pipeline.py", line 273, in run
    self.extract()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 256, in extract
    self.logger.info("Extracting text from XML dump...")
Message: 'Extracting text from XML dump...'
Arguments: ()
{"timestamp": "2025-11-13T16:24:57.059578+00:00", "level": "INFO", "logger": "wikipedia-somali", "message": "Phase 1: Parsing XML and collecting article metadata...", "run_id": "20251113_162457_wikipedia-somali_606c2c9a", "source": "wikipedia-somali", "phase": "extract"}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 256, in test_wikipedia_cli_full_pipeline_with_fixture
    result = processor.run()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/base_pipeline.py", line 273, in run
    self.extract()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 259, in extract
    self.logger.info("Phase 1: Parsing XML and collecting article metadata...")
Message: 'Phase 1: Parsing XML and collecting article metadata...'
Arguments: ()
{"timestamp": "2025-11-13T16:24:57.060272+00:00", "level": "INFO", "logger": "wikipedia-somali", "message": "Collected 3 articles from XML dump", "run_id": "20251113_162457_wikipedia-somali_606c2c9a", "source": "wikipedia-somali", "phase": "extract"}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 256, in test_wikipedia_cli_full_pipeline_with_fixture
    result = processor.run()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/base_pipeline.py", line 273, in run
    self.extract()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 299, in extract
    self.logger.info(f"Collected {len(raw_articles)} articles from XML dump")
Message: 'Collected 3 articles from XML dump'
Arguments: ()
{"timestamp": "2025-11-13T16:24:57.060738+00:00", "level": "INFO", "logger": "wikipedia-somali", "message": "Phase 2: Filtering articles based on last processing time...", "run_id": "20251113_162457_wikipedia-somali_606c2c9a", "source": "wikipedia-somali", "phase": "extract"}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 256, in test_wikipedia_cli_full_pipeline_with_fixture
    result = processor.run()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/base_pipeline.py", line 273, in run
    self.extract()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 302, in extract
    self.logger.info("Phase 2: Filtering articles based on last processing time...")
Message: 'Phase 2: Filtering articles based on last processing time...'
Arguments: ()
{"timestamp": "2025-11-13T16:24:57.061295+00:00", "level": "INFO", "logger": "wikipedia-somali", "message": "First run detected - processing all articles", "run_id": "20251113_162457_wikipedia-somali_606c2c9a", "source": "wikipedia-somali", "phase": "extract"}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/test_cli_e2e.py", line 256, in test_wikipedia_cli_full_pipeline_with_fixture
    result = processor.run()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/base_pipeline.py", line 273, in run
    self.extract()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 303, in extract
    articles_to_process, filter_stats = self._filter_new_articles(raw_articles)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py", line 542, in _filter_new_articles
    self.logger.info("First run detected - processing all articles")
Message: 'First run detected - processing all articles'
Arguments: ()
------------------------------ Captured log call -------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
INFO     wikipedia-somali:wikipedia_somali_processor.py:176 Dump already exists: data/raw/source=wikipedia-somali/date_accessed=2025-11-13/sowiki-latest-pages-articles.xml.bz2
INFO     wikipedia-somali:wikipedia_somali_processor.py:256 Extracting text from XML dump...
INFO     wikipedia-somali:wikipedia_somali_processor.py:259 Phase 1: Parsing XML and collecting article metadata...
INFO     wikipedia-somali:wikipedia_somali_processor.py:299 Collected 3 articles from XML dump
INFO     wikipedia-somali:wikipedia_somali_processor.py:302 Phase 2: Filtering articles based on last processing time...
INFO     wikipedia-somali:wikipedia_somali_processor.py:542 First run detected - processing all articles
________________ test_lock_prevents_concurrent_runs_same_source ________________
tests/test_concurrent_runs.py:51: in test_lock_prevents_concurrent_runs_same_source
    p1.start()
/opt/anaconda3/lib/python3.12/multiprocessing/process.py:121: in start
    self._popen = self._Popen(self)
/opt/anaconda3/lib/python3.12/multiprocessing/context.py:224: in _Popen
    return _default_context.get_context().Process._Popen(process_obj)
/opt/anaconda3/lib/python3.12/multiprocessing/context.py:289: in _Popen
    return Popen(process_obj)
/opt/anaconda3/lib/python3.12/multiprocessing/popen_spawn_posix.py:32: in __init__
    super().__init__(process_obj)
/opt/anaconda3/lib/python3.12/multiprocessing/popen_fork.py:19: in __init__
    self._launch(process_obj)
/opt/anaconda3/lib/python3.12/multiprocessing/popen_spawn_posix.py:47: in _launch
    reduction.dump(process_obj, fp)
/opt/anaconda3/lib/python3.12/multiprocessing/reduction.py:60: in dump
    ForkingPickler(file, protocol).dump(obj)
E   AttributeError: Can't pickle local object 'test_lock_prevents_concurrent_runs_same_source.<locals>.worker'
______________ test_lock_allows_concurrent_runs_different_sources ______________
tests/test_concurrent_runs.py:90: in test_lock_allows_concurrent_runs_different_sources
    p1.start()
/opt/anaconda3/lib/python3.12/multiprocessing/process.py:121: in start
    self._popen = self._Popen(self)
/opt/anaconda3/lib/python3.12/multiprocessing/context.py:224: in _Popen
    return _default_context.get_context().Process._Popen(process_obj)
/opt/anaconda3/lib/python3.12/multiprocessing/context.py:289: in _Popen
    return Popen(process_obj)
/opt/anaconda3/lib/python3.12/multiprocessing/popen_spawn_posix.py:32: in __init__
    super().__init__(process_obj)
/opt/anaconda3/lib/python3.12/multiprocessing/popen_fork.py:19: in __init__
    self._launch(process_obj)
/opt/anaconda3/lib/python3.12/multiprocessing/popen_spawn_posix.py:47: in _launch
    reduction.dump(process_obj, fp)
/opt/anaconda3/lib/python3.12/multiprocessing/reduction.py:60: in dump
    ForkingPickler(file, protocol).dump(obj)
E   AttributeError: Can't pickle local object 'test_lock_allows_concurrent_runs_different_sources.<locals>.worker'
__ TestConvenienceConstructors.test_create_news_filters_with_dialect_ruleset ___
tests/test_filters.py:328: in test_create_news_filters_with_dialect_ruleset
    assert any("dialect" in f[0].__name__ for f in filters)
E   assert False
E    +  where False = any(<generator object TestConvenienceConstructors.test_create_news_filters_with_dialect_ruleset.<locals>.<genexpr> at 0x30c1efd30>)
_____________ TestBackendSelection.test_explicit_postgres_backend ______________
tests/database/test_backend_compatibility.py:161: in test_explicit_postgres_backend
    ledger = CrawlLedger(
src/somali_dialect_classifier/preprocessing/crawl_ledger.py:1010: in __init__
    self.backend = PostgresLedger(
E   TypeError: Can't instantiate abstract class PostgresLedger without an implementation for abstract methods 'check_quota_available', 'get_daily_quota_usage', 'increment_daily_quota', 'mark_quota_hit'
_____________ TestBBCRSSFeedParsing.test_scrape_rss_feeds_success ______________
src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py:215: in _scrape_rss_feeds
    self.metrics.increment("rss_feeds_fetched")
E   AttributeError: 'NoneType' object has no attribute 'increment'

During handling of the above exception, another exception occurred:
tests/integration/test_bbc_processor_integration.py:137: in test_scrape_rss_feeds_success
    links = processor._scrape_rss_feeds()
src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py:221: in _scrape_rss_feeds
    self.metrics.increment("rss_feeds_failed")
E   AttributeError: 'NoneType' object has no attribute 'increment'
----------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 136, in test_scrape_rss_feeds_success
    processor = BBCSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 72, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 136, in test_scrape_rss_feeds_success
    processor = BBCSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 72, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
{"timestamp": "2025-11-13T16:25:09.967159+00:00", "level": "INFO", "logger": "bbc-somali", "message": "Scraping 2 RSS feeds..."}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 137, in test_scrape_rss_feeds_success
    links = processor._scrape_rss_feeds()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 193, in _scrape_rss_feeds
    self.logger.info(f"Scraping {len(feeds)} RSS feeds...")
Message: 'Scraping 2 RSS feeds...'
Arguments: ()
{"timestamp": "2025-11-13T16:25:09.967748+00:00", "level": "INFO", "logger": "bbc-somali", "message": "   Fetching RSS feed: https://www.bbc.com/somali/index.xml"}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 137, in test_scrape_rss_feeds_success
    links = processor._scrape_rss_feeds()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 203, in _scrape_rss_feeds
    self.logger.info(f"   Fetching RSS feed: {feed_url}")
Message: '   Fetching RSS feed: https://www.bbc.com/somali/index.xml'
Arguments: ()
{"timestamp": "2025-11-13T16:25:13.660595+00:00", "level": "ERROR", "logger": "bbc-somali", "message": "   Failed to parse RSS feed https://www.bbc.com/somali/index.xml: 'NoneType' object has no attribute 'increment'"}
--- Logging error ---
Traceback (most recent call last):
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 215, in _scrape_rss_feeds
    self.metrics.increment("rss_feeds_fetched")
    ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'increment'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 137, in test_scrape_rss_feeds_success
    links = processor._scrape_rss_feeds()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 220, in _scrape_rss_feeds
    self.logger.error(f"   Failed to parse RSS feed {feed_url}: {e}")
Message: "   Failed to parse RSS feed https://www.bbc.com/somali/index.xml: 'NoneType' object has no attribute 'increment'"
Arguments: ()
------------------------------ Captured log call -------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
INFO     bbc-somali:bbc_somali_processor.py:193 Scraping 2 RSS feeds...
INFO     bbc-somali:bbc_somali_processor.py:203    Fetching RSS feed: https://www.bbc.com/somali/index.xml
ERROR    bbc-somali:bbc_somali_processor.py:220    Failed to parse RSS feed https://www.bbc.com/somali/index.xml: 'NoneType' object has no attribute 'increment'
__________ TestBBCRSSFeedParsing.test_scrape_rss_feeds_handles_errors __________
src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py:215: in _scrape_rss_feeds
    self.metrics.increment("rss_feeds_fetched")
E   AttributeError: 'NoneType' object has no attribute 'increment'

During handling of the above exception, another exception occurred:
tests/integration/test_bbc_processor_integration.py:149: in test_scrape_rss_feeds_handles_errors
    links = processor._scrape_rss_feeds()
src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py:221: in _scrape_rss_feeds
    self.metrics.increment("rss_feeds_failed")
E   AttributeError: 'NoneType' object has no attribute 'increment'
----------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 148, in test_scrape_rss_feeds_handles_errors
    processor = BBCSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 72, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 349, in __init__
    self.lsh = ShardedLSH(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 148, in test_scrape_rss_feeds_handles_errors
    processor = BBCSomaliProcessor()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 72, in __init__
    self.dedup = DedupEngine(dedup_config)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 685, in __init__
    self.minhash = MinHashDeduplicator(
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 355, in __init__
    logger.info(f"Using ShardedLSH with {num_shards} shards for 2-3x performance")
Message: 'Using ShardedLSH with 10 shards for 2-3x performance'
Arguments: ()
{"timestamp": "2025-11-13T16:25:13.955772+00:00", "level": "INFO", "logger": "bbc-somali", "message": "Scraping 2 RSS feeds..."}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 149, in test_scrape_rss_feeds_handles_errors
    links = processor._scrape_rss_feeds()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 193, in _scrape_rss_feeds
    self.logger.info(f"Scraping {len(feeds)} RSS feeds...")
Message: 'Scraping 2 RSS feeds...'
Arguments: ()
{"timestamp": "2025-11-13T16:25:13.956418+00:00", "level": "INFO", "logger": "bbc-somali", "message": "   Skipping RSS feed (throttled): https://www.bbc.com/somali/index.xml"}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 149, in test_scrape_rss_feeds_handles_errors
    links = processor._scrape_rss_feeds()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 198, in _scrape_rss_feeds
    self.logger.info(f"   Skipping RSS feed (throttled): {feed_url}")
Message: '   Skipping RSS feed (throttled): https://www.bbc.com/somali/index.xml'
Arguments: ()
{"timestamp": "2025-11-13T16:25:13.956950+00:00", "level": "INFO", "logger": "bbc-somali", "message": "   Fetching RSS feed: https://feeds.bbci.co.uk/somali/rss.xml"}
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 149, in test_scrape_rss_feeds_handles_errors
    links = processor._scrape_rss_feeds()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 203, in _scrape_rss_feeds
    self.logger.info(f"   Fetching RSS feed: {feed_url}")
Message: '   Fetching RSS feed: https://feeds.bbci.co.uk/somali/rss.xml'
Arguments: ()
{"timestamp": "2025-11-13T16:25:14.866441+00:00", "level": "ERROR", "logger": "bbc-somali", "message": "   Failed to parse RSS feed https://feeds.bbci.co.uk/somali/rss.xml: 'NoneType' object has no attribute 'increment'"}
--- Logging error ---
Traceback (most recent call last):
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 215, in _scrape_rss_feeds
    self.metrics.increment("rss_feeds_fetched")
    ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'increment'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/opt/anaconda3/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/integration/test_bbc_processor_integration.py", line 149, in test_scrape_rss_feeds_handles_errors
    links = processor._scrape_rss_feeds()
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py", line 220, in _scrape_rss_feeds
    self.logger.error(f"   Failed to parse RSS feed {feed_url}: {e}")
Message: "   Failed to parse RSS feed https://feeds.bbci.co.uk/somali/rss.xml: 'NoneType' object has no attribute 'increment'"
Arguments: ()
------------------------------ Captured log call -------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:355 Using ShardedLSH with 10 shards for 2-3x performance
INFO     bbc-somali:bbc_somali_processor.py:193 Scraping 2 RSS feeds...
INFO     bbc-somali:bbc_somali_processor.py:198    Skipping RSS feed (throttled): https://www.bbc.com/somali/index.xml
INFO     bbc-somali:bbc_somali_processor.py:203    Fetching RSS feed: https://feeds.bbci.co.uk/somali/rss.xml
ERROR    bbc-somali:bbc_somali_processor.py:220    Failed to parse RSS feed https://feeds.bbci.co.uk/somali/rss.xml: 'NoneType' object has no attribute 'increment'
_______ TestShardedLSHPerformance.test_sharded_vs_monolithic_lsh_insert ________
tests/performance/test_performance_improvements.py:140: in test_sharded_vs_monolithic_lsh_insert
    assert speedup >= 1.5, f"Expected 1.5x+ speedup, got {speedup:.1f}x"
E   AssertionError: Expected 1.5x+ speedup, got 0.9x
E   assert 0.9475497559010587 >= 1.5
----------------------------- Captured stdout call -----------------------------

ShardedLSH Insert Performance:
  Monolithic time: 4.93s
  Sharded time: 5.21s
  Speedup: 0.9x
----------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/performance/test_performance_improvements.py", line 123, in test_sharded_vs_monolithic_lsh_insert
    lsh_sharded = ShardedLSH(num_shards=num_shards, threshold=0.8, num_perm=128)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
------------------------------ Captured log call -------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
_________ TestShardedLSHPerformance.test_sharded_lsh_query_performance _________
tests/performance/test_performance_improvements.py:199: in test_sharded_lsh_query_performance
    assert speedup >= 1.2, f"Expected 1.2x+ speedup, got {speedup:.1f}x"
E   AssertionError: Expected 1.2x+ speedup, got 0.1x
E   assert 0.11109590915309892 >= 1.2
----------------------------- Captured stdout call -----------------------------

ShardedLSH Query Performance:
  Monolithic query time: 0.001s
  Sharded query time: 0.009s
  Speedup: 0.1x
----------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/opt/anaconda3/bin/pytest", line 11, in <module>
    sys.exit(console_main())
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/anaconda3/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/opt/anaconda3/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/tests/performance/test_performance_improvements.py", line 166, in test_sharded_lsh_query_performance
    lsh_sharded = ShardedLSH(num_shards=num_shards, threshold=0.8, num_perm=128)
  File "/Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/dedup.py", line 78, in __init__
    logger.info(f"Initialized ShardedLSH with {num_shards} shards")
Message: 'Initialized ShardedLSH with 10 shards'
Arguments: ()
------------------------------ Captured log call -------------------------------
INFO     somali_dialect_classifier.preprocessing.dedup:dedup.py:78 Initialized ShardedLSH with 10 shards
_____________ TestFileIOPerformance.test_buffered_read_performance _____________
tests/performance/test_performance_improvements.py:320: in test_buffered_read_performance
    assert speedup >= 1.2, f"Expected 1.2x+ speedup, got {speedup:.1f}x"
E   AssertionError: Expected 1.2x+ speedup, got 1.0x
E   assert 1.028937517995969 >= 1.2
----------------------------- Captured stdout call -----------------------------

Buffered Read Performance:
  Standard time: 0.002s
  Buffered time: 0.002s
  Speedup: 1.0x
______________________ TestFilterEngine.test_filter_stats ______________________
tests/pipeline/test_filter_engine.py:82: in test_filter_stats
    assert "filtered_by_min_length_filter" in stats
E   AssertionError: assert 'filtered_by_min_length_filter' in {}
=============================== warnings summary ===============================
tests/test_bbc_integration.py: 48 warnings
tests/test_cli_e2e.py: 8 warnings
tests/test_deduplication_integration.py: 24 warnings
tests/test_foundation.py: 22 warnings
tests/test_incremental_processing.py: 16 warnings
tests/test_ledger_incremental.py: 2084 warnings
tests/database/test_backend_compatibility.py: 6 warnings
  /Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/crawl_ledger.py:476: DeprecationWarning: The default datetime adapter is deprecated as of Python 3.12; see the sqlite3 documentation for suggested replacement recipes
    conn.execute(

tests/test_deduplication_integration.py: 18 warnings
tests/test_foundation.py: 51 warnings
tests/test_incremental_processing.py: 24 warnings
tests/test_ledger_incremental.py: 3141 warnings
tests/database/test_backend_compatibility.py: 36 warnings
tests/security/test_security_fixes.py: 12 warnings
  /Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/crawl_ledger.py:514: DeprecationWarning: The default datetime adapter is deprecated as of Python 3.12; see the sqlite3 documentation for suggested replacement recipes
    conn.execute(

tests/test_ledger_incremental.py::TestGetLastProcessingTime::test_ignores_non_processed_states
tests/test_ledger_incremental.py::TestGetProcessedUrls::test_returns_only_processed_urls
  /Users/ilyas/Desktop/Computer Programming/somali-nlp-projects/somali-dialect-classifier/src/somali_dialect_classifier/preprocessing/crawl_ledger.py:576: DeprecationWarning: The default datetime adapter is deprecated as of Python 3.12; see the sqlite3 documentation for suggested replacement recipes
    conn.execute(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.12.3-final-0 _______________

Name                                                                          Stmts   Miss  Cover   Missing
-----------------------------------------------------------------------------------------------------------
src/somali_dialect_classifier/cli/download_bbcsom.py                             35     22    37%   25-50, 86-107
src/somali_dialect_classifier/cli/download_wikisom.py                            28      6    79%   65-71
src/somali_dialect_classifier/config.py                                         174     80    54%   39-42, 332-333, 353-354, 401-531, 559
src/somali_dialect_classifier/data/__init__.py                                    2      0   100%
src/somali_dialect_classifier/data/data_manager.py                              215    142    34%   32-34, 115, 120-121, 152-184, 205-229, 253-269, 288-313, 332-357, 376-387, 400-406, 422-426, 442-447, 471-476, 559-572, 591-593, 615, 644-645, 661-666
src/somali_dialect_classifier/database/__init__.py                                2      0   100%
src/somali_dialect_classifier/database/postgres_ledger.py                       166    134    19%   68-85, 90-94, 99-106, 114-192, 215-251, 278-295, 301-319, 325-348, 352-359, 370-383, 387-394, 398-411, 415-421, 425-529, 533-545, 549-551, 562-566
src/somali_dialect_classifier/deployment/__init__.py                              2      0   100%
src/somali_dialect_classifier/deployment/dashboard_deployer.py                  250    203    19%   54-63, 76-109, 122-137, 146-155, 160-170, 180-220, 239-251, 265-278, 293-307, 320-321, 325-330, 342-358, 376-411, 420-440, 452-559, 572-579
src/somali_dialect_classifier/orchestration/__init__.py                           2      2     0%   8-16
src/somali_dialect_classifier/orchestration/flows.py                            442    442     0%   11-1060
src/somali_dialect_classifier/pipeline/__init__.py                                0      0   100%
src/somali_dialect_classifier/pipeline/filter_engine.py                          39      1    97%   95
src/somali_dialect_classifier/pipeline/filters/__init__.py                        2      0   100%
src/somali_dialect_classifier/pipeline/filters/catalog.py                        39     26    33%   136-140, 157-161, 181-185, 207, 231-232, 247-252, 275-283
src/somali_dialect_classifier/preprocessing/__init__.py                           8      0   100%
src/somali_dialect_classifier/preprocessing/apify_tiktok_client.py              101     80    21%   52-58, 62-72, 76, 100-124, 144-177, 193-201, 216-239, 261-286, 295-299, 320-332
src/somali_dialect_classifier/preprocessing/base_pipeline.py                    212     84    60%   94, 98, 102, 106, 110, 114, 118, 122, 130-134, 152-154, 172-173, 178, 180-181, 190, 215-217, 237-253, 257-264, 268, 274, 278-295, 309, 316-322, 331-343, 356-361, 374, 388-398
src/somali_dialect_classifier/preprocessing/bbc_somali_processor.py             570    399    30%   30-32, 216-217, 223-226, 248-329, 345-384, 397-416, 429-479, 488-638, 650-660, 669-875, 888, 912-945, 968-978, 1026-1028, 1043-1071, 1083-1106, 1115-1140, 1169-1171, 1197-1198, 1203-1204, 1233, 1247, 1255-1256
src/somali_dialect_classifier/preprocessing/crawl_ledger.py                     409     85    79%   176, 195, 200, 207, 214, 219, 226, 231, 236, 241, 246, 251, 262, 273, 280, 285, 348-351, 474, 588, 618-629, 768-782, 795-816, 844-864, 882-888, 914-924, 974-975, 990-993, 1013, 1098, 1115, 1123, 1133-1136, 1144, 1226, 1254, 1263, 1275, 1286, 1305, 1331, 1353, 1376, 1384, 1388, 1419-1421
src/somali_dialect_classifier/preprocessing/data_processor.py                    15      4    73%   21, 26, 31, 36
src/somali_dialect_classifier/preprocessing/dedup.py                            317    102    68%   23-26, 63, 157-158, 182-185, 194-201, 277-278, 298, 334, 357-359, 421-426, 524, 537-538, 569-586, 596-597, 619-620, 635-650, 658, 695, 737-742, 767, 777-779, 783-793, 815-826, 853-875, 896-920
src/somali_dialect_classifier/preprocessing/filters.py                           81      4    95%   78, 292-293, 531
src/somali_dialect_classifier/preprocessing/huggingface_somali_processor.py     505    411    19%   29-32, 100, 131, 134-137, 187, 199-313, 325-601, 605-609, 622-639, 643-644, 656-857, 866-889, 902-935, 967, 969, 982-988, 992, 994, 996, 1013, 1017, 1029-1040, 1054-1059, 1071-1085, 1096-1106, 1117-1124, 1145
src/somali_dialect_classifier/preprocessing/pipeline_setup.py                    54      4    93%   84, 104, 128, 151
src/somali_dialect_classifier/preprocessing/raw_record.py                         7      0   100%
src/somali_dialect_classifier/preprocessing/record_builder.py                    24      0   100%
src/somali_dialect_classifier/preprocessing/record_utils.py                      22      3    86%   136-139
src/somali_dialect_classifier/preprocessing/schema_mappers.py                    70     40    43%   91, 93, 112-125, 137-140, 152-155, 167-173, 191-207, 220-230
src/somali_dialect_classifier/preprocessing/silver_writer.py                    198     92    54%   151, 161-171, 191, 195-199, 203, 208-211, 216, 220-224, 256-257, 279-295, 312-324, 410, 421, 487-498, 538-575, 587-612
src/somali_dialect_classifier/preprocessing/sprakbanken_somali_processor.py     328    267    19%   180, 182, 189, 225-237, 241-249, 259, 264, 268, 272, 276, 289, 301, 314, 330-342, 354-372, 384, 407-440, 449-572, 581-656, 676-747, 773-834, 857-915, 919-926, 935-941, 949-976, 985, 1000, 1013
src/somali_dialect_classifier/preprocessing/text_cleaners.py                     59      0   100%
src/somali_dialect_classifier/preprocessing/tiktok_somali_processor.py          186    124    33%   127, 131, 135, 139, 149, 161, 173-237, 246-391, 470-472, 481-494
src/somali_dialect_classifier/preprocessing/wikipedia_somali_processor.py       255     86    66%   136, 148, 161, 186-194, 230, 243, 248-250, 253-254, 272-274, 292-297, 309-367, 376-405, 430-452, 483
src/somali_dialect_classifier/schema/__init__.py                                  3      0   100%
src/somali_dialect_classifier/schema/migrations/__init__.py                       3      3     0%   7-10
src/somali_dialect_classifier/schema/migrations/base.py                          62     62     0%   7-183
src/somali_dialect_classifier/schema/migrations/manager.py                       60     60     0%   7-209
src/somali_dialect_classifier/schema/migrations/v1_0_to_v1_1.py                  17     17     0%   10-55
src/somali_dialect_classifier/schema/registry.py                                109      1    99%   163
src/somali_dialect_classifier/schema/validation_service.py                       27      3    89%   81-82, 90
src/somali_dialect_classifier/schema/validator.py                                58      0   100%
src/somali_dialect_classifier/utils/__init__.py                                   4      0   100%
src/somali_dialect_classifier/utils/aggregation.py                              137     14    90%   204, 233, 254, 258, 283, 323-326, 385-386, 395-397, 462
src/somali_dialect_classifier/utils/filter_analysis.py                          108    108     0%   23-374
src/somali_dialect_classifier/utils/http.py                                      29      0   100%
src/somali_dialect_classifier/utils/logging_utils.py                            150     40    73%   76, 80, 88, 120-123, 127-142, 214, 227, 274-281, 305, 364-379, 424-453
src/somali_dialect_classifier/utils/manifest_writer.py                          112    112     0%   11-406
src/somali_dialect_classifier/utils/metrics.py                                  709    342    52%   90-107, 111, 127, 131, 151-153, 158-160, 164-194, 214-216, 221-223, 227-245, 266-269, 274-276, 281-283, 287-306, 324-326, 331, 335-353, 357, 385-387, 392-394, 398-407, 411, 446-456, 484-517, 575, 617, 645-652, 668-669, 738, 755-770, 784, 795, 819-829, 867, 897, 953, 957, 969, 990-991, 1054-1181, 1203-1248, 1276-1541, 1617-1626, 1636, 1653-1661, 1695-1722, 1741-1747, 1763-1767, 1818-1819, 1861, 1873-1892, 1899-1918, 1934-1950, 1958, 1973-1975, 1985-1989, 1997, 2009, 2011, 2020-2021, 2026
src/somali_dialect_classifier/utils/metrics_comparison.py                       183    183     0%   15-583
src/somali_dialect_classifier/utils/metrics_filters.py                          149    149     0%   15-475
src/somali_dialect_classifier/utils/metrics_schema.py                           208      9    96%   61, 64, 81-88, 266-267, 411, 427
src/somali_dialect_classifier/utils/rate_limiter.py                             144     92    36%   94-101, 105-114, 123-133, 142-160, 172-177, 190-209, 219-224, 237-253, 266-294, 298-301, 305-317, 333-335, 340-342, 346-354, 358
src/somali_dialect_classifier/utils/security.py                                  81     27    67%   55, 141-168, 233-256, 291, 317-318, 322-323
src/somali_dialect_classifier/utils/visualization_aggregator.py                 176    176     0%   14-503
-----------------------------------------------------------------------------------------------------------
TOTAL                                                                          7348   4241    42%
Coverage HTML written to dir htmlcov
=========================== short test summary info ============================
FAILED tests/test_bbc_integration.py::TestBBCIntegration::test_creates_silver_dataset
FAILED tests/test_cli_e2e.py::TestWikipediaCLI::test_cli_help_output - Attrib...
FAILED tests/test_cli_e2e.py::TestCLIDataDirectories::test_wikipedia_creates_partitioned_directories
FAILED tests/test_cli_e2e.py::TestCLIDataDirectories::test_bbc_creates_partitioned_directories
FAILED tests/test_cli_e2e.py::TestCLIOutput::test_processors_have_consistent_logging_format
FAILED tests/test_cli_e2e.py::TestCLIIntegration::test_wikipedia_cli_full_pipeline_with_fixture
FAILED tests/test_concurrent_runs.py::test_lock_prevents_concurrent_runs_same_source
FAILED tests/test_concurrent_runs.py::test_lock_allows_concurrent_runs_different_sources
FAILED tests/test_filters.py::TestConvenienceConstructors::test_create_news_filters_with_dialect_ruleset
FAILED tests/database/test_backend_compatibility.py::TestBackendSelection::test_explicit_postgres_backend
FAILED tests/integration/test_bbc_processor_integration.py::TestBBCRSSFeedParsing::test_scrape_rss_feeds_success
FAILED tests/integration/test_bbc_processor_integration.py::TestBBCRSSFeedParsing::test_scrape_rss_feeds_handles_errors
FAILED tests/performance/test_performance_improvements.py::TestShardedLSHPerformance::test_sharded_vs_monolithic_lsh_insert
FAILED tests/performance/test_performance_improvements.py::TestShardedLSHPerformance::test_sharded_lsh_query_performance
FAILED tests/performance/test_performance_improvements.py::TestFileIOPerformance::test_buffered_read_performance
FAILED tests/pipeline/test_filter_engine.py::TestFilterEngine::test_filter_stats
ERROR tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_extract_corpus_id_from_korp_url
ERROR tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_extract_corpus_id_from_download_url
ERROR tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_first_run_processes_all_corpora
ERROR tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_subsequent_run_filters_processed_corpora
ERROR tests/test_incremental_processing.py::TestSprakbankenIncrementalProcessing::test_all_corpora_processed_skips_all
ERROR tests/test_incremental_processing.py::TestIncrementalProcessingMetrics::test_sprakbanken_incremental_metrics
ERROR tests/test_incremental_processing.py::TestFailSafeBehavior::test_query_error_returns_empty_set
ERROR tests/database/test_backend_compatibility.py::TestBackendAPIs::test_discover_url_postgres
ERROR tests/database/test_backend_compatibility.py::TestBackendAPIs::test_mark_fetched_postgres
ERROR tests/database/test_backend_compatibility.py::TestBackendAPIs::test_mark_processed_postgres
ERROR tests/database/test_backend_compatibility.py::TestBackendAPIs::test_is_duplicate_postgres
ERROR tests/database/test_backend_compatibility.py::TestBackendBehaviorParity::test_statistics_parity_postgres
ERROR tests/database/test_backend_compatibility.py::TestBackendBehaviorParity::test_get_pending_urls_postgres
ERROR tests/database/test_load_postgres.py::TestConcurrentWrites::test_5_concurrent_sources
ERROR tests/database/test_load_postgres.py::TestConcurrentWrites::test_10x_concurrent_writes
ERROR tests/database/test_load_postgres.py::TestQueryPerformance::test_concurrent_reads_and_writes
ERROR tests/database/test_load_postgres.py::TestQueryPerformance::test_bulk_operations
ERROR tests/database/test_load_postgres.py::TestConnectionPooling::test_connection_pool_exhaustion
ERROR tests/database/test_load_postgres.py::TestStressScenarios::test_rapid_state_transitions
ERROR tests/database/test_load_postgres.py::TestStressScenarios::test_concurrent_duplicate_detection
ERROR tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_connection_pool_creation
ERROR tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_schema_initialization
ERROR tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_upsert_url_insert
ERROR tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_upsert_url_update
ERROR tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_get_urls_by_state
ERROR tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_mark_url_state
ERROR tests/database/test_postgres_ledger.py::TestPostgresLedgerBasics::test_check_duplicate_by_hash
ERROR tests/database/test_postgres_ledger.py::TestPostgresConcurrency::test_concurrent_writes_10_threads
ERROR tests/database/test_postgres_ledger.py::TestPostgresConcurrency::test_concurrent_writes_50_threads
ERROR tests/database/test_postgres_ledger.py::TestPostgresPerformance::test_query_latency
ERROR tests/database/test_postgres_ledger.py::TestPostgresPerformance::test_bulk_insert_performance
ERROR tests/database/test_postgres_ledger.py::TestPostgresStatistics::test_get_statistics
ERROR tests/database/test_postgres_ledger.py::TestPostgresRSSFeed::test_record_rss_fetch
ERROR tests/database/test_postgres_ledger.py::TestPostgresRSSFeed::test_should_fetch_rss
ERROR tests/database/test_postgres_ledger.py::TestPostgresCleanup::test_cleanup_old_entries
ERROR tests/database/test_postgres_ledger.py::TestPostgresCleanup::test_connection_pool_close
= 16 failed, 420 passed, 169 skipped, 2 xfailed, 5492 warnings, 36 errors in 94.32s (0:01:34) =
