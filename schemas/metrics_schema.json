{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://somali-nlp.github.io/schemas/all_metrics.json",
  "title": "Dashboard Metrics Schema",
  "description": "JSON schema for validating the aggregated metrics file used by the dashboard",
  "type": "object",
  "required": ["count", "records", "sources", "pipeline_types", "metrics", "schema_version"],
  "properties": {
    "count": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of pipeline runs"
    },
    "records": {
      "type": "integer",
      "minimum": 0,
      "description": "Total records written across all runs"
    },
    "sources": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of unique data sources"
    },
    "pipeline_types": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["web_scraping", "file_processing", "stream_processing", "unknown"]
      },
      "description": "List of pipeline types present in metrics"
    },
    "schema_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+$",
      "description": "Schema version (e.g., '2.0')"
    },
    "backward_compatible": {
      "type": "boolean",
      "description": "Indicates if old field names are still present"
    },
    "metrics": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/metricEntry"
      },
      "description": "Array of individual pipeline run metrics"
    }
  },
  "definitions": {
    "metricEntry": {
      "type": "object",
      "required": [
        "run_id",
        "source",
        "timestamp",
        "duration_seconds",
        "pipeline_type",
        "pipeline_metrics",
        "performance",
        "quality"
      ],
      "properties": {
        "run_id": {
          "type": "string",
          "pattern": "^[0-9]{8}_[0-9]{6}_[a-zA-Z0-9_-]+_[a-f0-9]{8}$",
          "description": "Unique identifier for the pipeline run"
        },
        "source": {
          "type": "string",
          "minLength": 1,
          "description": "Data source name"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of the run"
        },
        "duration_seconds": {
          "type": "number",
          "minimum": 0,
          "description": "Total duration of the pipeline run in seconds"
        },
        "pipeline_type": {
          "type": "string",
          "enum": ["web_scraping", "file_processing", "stream_processing", "unknown"],
          "description": "Type of data pipeline"
        },
        "urls_discovered": {
          "type": "integer",
          "minimum": 0
        },
        "urls_fetched": {
          "type": "integer",
          "minimum": 0
        },
        "urls_processed": {
          "type": "integer",
          "minimum": 0
        },
        "files_discovered": {
          "type": "integer",
          "minimum": 0
        },
        "files_processed": {
          "type": "integer",
          "minimum": 0
        },
        "records_fetched": {
          "type": "integer",
          "minimum": 0
        },
        "records_written": {
          "type": "integer",
          "minimum": 0
        },
        "bytes_downloaded": {
          "type": "integer",
          "minimum": 0
        },
        "pipeline_metrics": {
          "type": "object",
          "required": ["pipeline_type"],
          "properties": {
            "pipeline_type": {
              "type": "string"
            },
            "quality_pass_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "deduplication_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "http_success_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "extraction_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "file_extraction_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "parsing_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "connection_success": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "retrieval_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "coverage_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "success_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          }
        },
        "performance": {
          "type": "object",
          "required": ["urls_per_second", "bytes_per_second", "records_per_minute"],
          "properties": {
            "urls_per_second": {
              "type": "number",
              "minimum": 0
            },
            "bytes_per_second": {
              "type": "number",
              "minimum": 0
            },
            "records_per_minute": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "quality": {
          "type": "object",
          "required": ["min", "max", "mean", "median", "total_chars"],
          "properties": {
            "min": {
              "type": "integer",
              "minimum": 0
            },
            "max": {
              "type": "integer",
              "minimum": 0
            },
            "mean": {
              "type": "number",
              "minimum": 0
            },
            "median": {
              "type": "number",
              "minimum": 0
            },
            "total_chars": {
              "type": "integer",
              "minimum": 0
            }
          }
        }
      }
    }
  }
}
